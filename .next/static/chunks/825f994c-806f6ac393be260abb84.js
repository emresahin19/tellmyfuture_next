(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[918],{82059:function(t,e,a){!function(){var n,r,s,o,i,l,c,p={version:"0.7.35",container:null,data:[]},d=10,u=1,f={},h={};if(p.display=function(t){var e,a=p.container,m=[],y=0,g=!1;J((n=E.set(t).applyDefaults(t)).zoomextend)&&(d=n.zoomextend),J(n.zoomlevel)&&(u=n.zoomlevel);var T=document.getElementById(n.container);if(T){s="#"+n.container;var L=window.getComputedStyle(T,null);parseInt(L.width)||n.width||(T.style.width=V(T.parentNode.clientWidth))}else s="body",T=null;var D=[16,16],F=Wt(),_=J(n.background.width)?F+n.background.width:F,Q=window.devicePixelRatio||1,Z=Vt(n.projection,n.projectionRatio);if(Z){n.lines.graticule.lat&&"outline"===n.lines.graticule.lat.pos[0]&&(Z.scale-=2);var X=Z.ratio,tt=Math.round(F/X),et=Math.round(_/X),at=Z.scale*F/1024,nt=n.stars.size,rt=n.dsos.size||nt,st=n.stars.exponent,lt=n.dsos.exponent||st,yt=1,gt=x(n.center),vt=n.datapath;"body"!==s&&(T.style.height=V(et)),r=p.projection(n.projection).rotate(gt).translate([_/2,et/2]).scale(at*u),o=d3.geo.zoom().projection(r).center([_/2,et/2]).scaleExtent([at,at*d]).on("zoom.redraw",qt),at*=u;var Mt=d3.select(s).selectAll("canvas"),bt=""!==n.culture&&"iau"!==n.culture?n.culture:"";0===Mt[0].length&&(Mt=d3.select(s).append("canvas")),Mt.style("width",V(_)).style("height",V(et)).attr("width",_*Q).attr("height",et*Q);var wt=Mt.node().getContext("2d");wt.setTransform(Q,0,0,Q,0,0);var xt=d3.geo.graticule().minorStep([15,10]);i=d3.geo.path().projection(r).context(wt),a?a.selectAll(s+" *").remove():a=d3.select(s).append("container"),n.interactive?(Mt.call(o),d3.select(s).on("dblclick",(function(){return Tt(1.5625),!1}))):Mt.attr("style","cursor: default!important"),Nt(Z.clip),d3.select(window).on("resize",It),!0===n.interactive&&!0===n.controls&&null===W("celestial-zoomin")&&(d3.select(s).append("input").attr("type","button").attr("id","celestial-zoomin").attr("value","+").on("click",(function(){return Tt(1.25),!1})),d3.select(s).append("input").attr("type","button").attr("id","celestial-zoomout").attr("value","\u2212").on("click",(function(){return Tt(.8),!1}))),l=d3.geo.circle().angle([90]),c=d3.geo.circle().angle([179.9]),function(t){var e=E.set(t),a=p.projections(),n=p.eulerAngles(),r=d3.select(s+" ~ #celestial-form");r.size()<1&&(r=d3.select(s).select((function(){return this.parentNode})).append("div").attr("id","celestial-form"));var o=r.append("div").attr("class","ctrl").append("form").attr("id","params").attr("name","params").attr("method","get").attr("action","#"),i=o.append("div").attr("class","col").attr("id","general");i.append("label").attr("title","Map width in pixel, 0 indicates full width").attr("for","width").html("Width "),i.append("input").attr("type","number").attr("maxlength","4").attr("max","20000").attr("min","0").attr("title","Map width").attr("id","width").attr("value",e.width).on("change",v),i.append("span").html("px"),i.append("label").attr("title","Map projection, (hemi) indicates hemispherical projection").attr("for","projection").html("Projection");var l=i.append("select").attr("id","projection").on("change",b),c=0,d=Object.keys(a).map((function(t,n){var r=a[t].clip&&!0===a[t].clip?a[t].n+" (hemi)":a[t].n;return t===e.projection&&(c=n),{o:t,n:r}}));l.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),l.property("selectedIndex",c),c=0,i.append("label").attr("title","Coordinate space in which the map is displayed").attr("for","transform").html("Coordinates"),l=i.append("select").attr("id","transform").on("change",M),d=Object.keys(n).map((function(t,a){return t===e.transform&&(c=a),{o:t,n:t.replace(/^([a-z])/,(function(t,e){return e.toUpperCase()}))}})),l.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),l.property("selectedIndex",c),i.append("br"),i.append("label").attr("title","Center coordinates long/lat in selected coordinate space").attr("for","centerx").html("Center"),i.append("input").attr("type","number").attr("id","centerx").attr("title","Center right ascension/longitude").attr("max","24").attr("min","0").attr("step","0.1").on("change",w),i.append("span").attr("id","cxunit").html("h"),i.append("input").attr("type","number").attr("id","centery").attr("title","Center declination/latitude").attr("max","90").attr("min","-90").attr("step","0.1").on("change",w),i.append("span").html("\xb0"),i.append("label").attr("title","Orientation").attr("for","centerz").html("Orientation"),i.append("input").attr("type","number").attr("id","centerz").attr("title","Center orientation").attr("max","180").attr("min","-180").attr("step","0.1").on("change",w),i.append("span").html("\xb0"),i.append("label").attr("for","orientationfixed").attr("class","advanced").html("Fixed"),i.append("input").attr("type","checkbox").attr("id","orientationfixed").attr("class","advanced").property("checked",e.orientationfixed).on("change",P),i.append("label").attr("title","Center and zoom in on this constellation").attr("for","constellation").html("Show"),i.append("select").attr("id","constellation").on("change",T),ut(e.center,e.transform),(i=o.append("div").attr("class","col").attr("id","stars")).append("label").attr("class","header").attr("for","stars-show").html("Stars"),i.append("input").attr("type","checkbox").attr("id","stars-show").property("checked",e.stars.show).on("change",P),i.append("label").attr("for","stars-limit").html("down to magnitude"),i.append("input").attr("type","number").attr("id","stars-limit").attr("title","Star display limit (magnitude)").attr("value",e.stars.limit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",P),i.append("label").attr("for","stars-colors").html("with spectral colors"),i.append("input").attr("type","checkbox").attr("id","stars-colors").property("checked",e.stars.colors).on("change",P),i.append("label").attr("for","stars-color").html("or default color "),i.append("input").attr("type","color").attr("autocomplete","off").attr("id","stars-style-fill").attr("title","Star color").property("value",e.stars.style.fill).on("change",P),i.append("br");var u=B.starnames[e.culture]||B.starnames.iau;for(var f in u)if(Y(u,f)){var h=Object.keys(u[f]);h.length>1?(i.append("label").attr("for","stars-"+f).html("Show"),c=0,i.append("label").attr("title","Type of star name").attr("id","label-propername").attr("for","stars-"+f+"Type").html((function(){return"propername"===f?"proper names":""})),l=i.append("select").attr("id","stars-"+f+"Type").attr("class",(function(){return"propername"===f?"advanced":""})).on("change",P),d=h.map((function(t,a){return t===e.stars[f+"Type"]&&(c=a),{o:t,n:u[f][t]}})),l.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),l.property("selectedIndex",c),i.append("input").attr("type","checkbox").attr("id","stars-"+f).property("checked",e.stars[f]).on("change",P)):1===h.length&&(i.append("label").attr("for","stars-"+f).html(" "+u[f][h[0]]),i.append("input").attr("type","checkbox").attr("id","stars-"+f).property("checked",e.stars[f]).on("change",P)),i.append("label").attr("for","stars-"+f+"Limit").html("down to mag"),i.append("input").attr("type","number").attr("id","stars-"+f+"Limit").attr("title","Star name display limit (magnitude)").attr("value",e.stars[f+"Limit"]).attr("max","6").attr("min","-1").attr("step","0.1").on("change",P)}for(f in i.append("br"),i.append("label").attr("for","stars-size").attr("class","advanced").html("Stellar disk size: base"),i.append("input").attr("type","number").attr("id","stars-size").attr("class","advanced").attr("title","Size of the displayed star disk; base").attr("value",e.stars.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",P),i.append("label").attr("for","stars-exponent").attr("class","advanced").html(" * e ^ (exponent"),i.append("input").attr("type","number").attr("id","stars-exponent").attr("class","advanced").attr("title","Size of the displayed star disk; exponent").attr("value",e.stars.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",P),i.append("span").attr("class","advanced").text(" * (magnitude + 2))  [* adaptation]"),ot(mt("stars-show")),(i=o.append("div").attr("class","col").attr("id","dsos")).append("label").attr("class","header").attr("title","Deep Space Objects").attr("for","dsos-show").html("DSOs"),i.append("input").attr("type","checkbox").attr("id","dsos-show").property("checked",e.dsos.show).on("change",P),i.append("label").attr("for","dsos-limit").html("down to mag"),i.append("input").attr("type","number").attr("id","dsos-limit").attr("title","DSO display limit (magnitude)").attr("value",e.dsos.limit).attr("max","6").attr("min","0").attr("step","0.1").on("change",P),i.append("label").attr("for","dsos-colors").html("with symbol colors"),i.append("input").attr("type","checkbox").attr("id","dsos-colors").property("checked",e.dsos.colors).on("change",P),i.append("label").attr("for","dsos-color").html("or default color "),i.append("input").attr("type","color").attr("autocomplete","off").attr("id","dsos-style-fill").attr("title","DSO color").property("value",e.dsos.style.fill).on("change",P),i.append("br"),u=B.dsonames[e.culture]||B.dsonames.iau)if(Y(u,f)){var m=Object.keys(u[f]);i.append("label").attr("for","dsos-"+f).html("Show"),c=0,i.append("label").attr("title","Type of DSO name").attr("for","dsos-"+f+"Type").attr("class","advanced").html(""),l=i.append("select").attr("id","dsos-"+f+"Type").attr("class","advanced").on("change",P),d=m.map((function(t,a){return t===e.stars[f+"Type"]&&(c=a),{o:t,n:u[f][t]}})),l.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),l.property("selectedIndex",c),i.append("label").attr("for","dsos-"+f).html("names"),i.append("input").attr("type","checkbox").attr("id","dsos-"+f).property("checked",e.dsos[f]).on("change",P)}for(f in i.append("label").attr("for","dsos-nameLimit").html("down to mag"),i.append("input").attr("type","number").attr("id","dsos-nameLimit").attr("title","DSO name display limit (magnitude)").attr("value",e.dsos.nameLimit).attr("max","6").attr("min","0").attr("step","0.1").on("change",P),i.append("br"),i.append("label").attr("for","dsos-size").attr("class","advanced").html("DSO symbol size: (base"),i.append("input").attr("type","number").attr("id","dsos-size").attr("class","advanced").attr("title","Size of the displayed symbol: base").attr("value",e.dsos.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",P),i.append("label").attr("for","dsos-exponent").attr("class","advanced").html(" * 2 [* adaptation] - magnitude) ^ exponent"),i.append("input").attr("type","number").attr("id","dsos-exponent").attr("class","advanced").attr("title","Size of the displayed symbol; exponent").attr("value",e.dsos.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",P),ot(mt("dsos-show")),(i=o.append("div").attr("class","col").attr("id","constellations")).append("label").attr("class","header").html("Constellations"),u=B.constellations[e.culture]||B.constellations.iau)if(Y(u,f)){var y=Object.keys(u[f]);y.length>1?(i.append("label").attr("for","constellations-"+f).html("Show"),c=0,i.append("label").attr("title","Language of constellation names").attr("for","constellations-"+f+"Type").attr("class","advanced").html(""),l=i.append("select").attr("id","constellations-"+f+"Type").attr("class","advanced").on("change",P),d=y.map((function(t,a){return t===e.constellations[f+"Type"]&&(c=a),{o:t,n:u[f][t]}})),l.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),l.property("selectedIndex",c),i.append("label").attr("for","constellations-"+f).html("names"),i.append("input").attr("type","checkbox").attr("id","constellations-"+f).property("checked",e.constellations[f]).on("change",P)):1===y.length&&(i.append("label").attr("for","constellations-"+f).attr("class","advanced").html(" "+u[f][y[0]]),i.append("input").attr("type","checkbox").attr("id","constellations-"+f).attr("class","advanced").property("checked",e.constellations[f]).on("change",P))}i.append("label").attr("for","constellations-lines").html(" lines"),i.append("input").attr("type","checkbox").attr("id","constellations-lines").property("checked",e.constellations.lines).on("change",P),i.append("label").attr("for","constellations-bounds").html(" boundaries"),i.append("input").attr("type","checkbox").attr("id","constellations-bounds").property("checked",e.constellations.bounds).on("change",P),ot(mt("constellations-names")),(i=o.append("div").attr("class","col").attr("id","lines")).append("label").attr("class","header").html("Lines"),i.append("label").attr("title","Latitude/longitude grid lines").attr("for","lines-graticule").html("Graticule"),i.append("input").attr("type","checkbox").attr("id","lines-graticule-show").property("checked",e.lines.graticule.show).on("change",P),i.append("label").attr("for","lines-equatorial").html("Equator"),i.append("input").attr("type","checkbox").attr("id","lines-equatorial-show").property("checked",e.lines.equatorial.show).on("change",P),i.append("label").attr("for","lines-ecliptic").html("Ecliptic"),i.append("input").attr("type","checkbox").attr("id","lines-ecliptic-show").property("checked",e.lines.ecliptic.show).on("change",P),i.append("label").attr("for","lines-galactic").html("Galactic plane"),i.append("input").attr("type","checkbox").attr("id","lines-galactic-show").property("checked",e.lines.galactic.show).on("change",P),i.append("label").attr("for","lines-supergalactic").html("Supergalactic plane"),i.append("input").attr("type","checkbox").attr("id","lines-supergalactic-show").property("checked",e.lines.supergalactic.show).on("change",P),(i=o.append("div").attr("class","col").attr("id","other")).append("label").attr("class","header").html("Other"),i.append("label").attr("for","mw-show").html("Milky Way"),i.append("input").attr("type","checkbox").attr("id","mw-show").property("checked",e.mw.show).on("change",P),i.append("label").attr("for","mw-style-fill").attr("class","advanced").html(" color"),i.append("input").attr("type","color").attr("id","mw-style-fill").attr("class","advanced").attr("title","Milky Way color").attr("value",e.mw.style.fill).on("change",P),i.append("label").attr("for","mw-style-opacity").attr("class","advanced").html(" opacity"),i.append("input").attr("type","number").attr("id","mw-style-opacity").attr("class","advanced").attr("title","Transparency of each Milky Way layer").attr("value",e.mw.style.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",P),i.append("label").attr("for","advanced").html("Advanced options"),i.append("input").attr("type","checkbox").attr("id","advanced").property("checked",e.advanced).on("change",P),i.append("br"),i.append("label").attr("for","background-fill").html("Background color"),i.append("input").attr("type","color").attr("id","background-fill").attr("title","Background color").attr("value",e.background.fill).on("change",P),i.append("label").attr("for","background-opacity").attr("class","advanced").html("opacity"),i.append("input").attr("type","number").attr("id","background-opacity").attr("class","advanced").attr("title","Background opacity").attr("value",e.background.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",P),i.append("label").attr("title","Star/DSO sizes are increased with higher zoom-levels").attr("for","adaptable").attr("class","advanced").html("Adaptable object sizes"),i.append("input").attr("type","checkbox").attr("id","adaptable").attr("class","advanced").property("checked",e.adaptable).on("change",P);var g=G[e.culture];function v(){var t=this,a=t.value;!1!==ct(t)&&(e.width=a,p.resize({width:a}))}function M(){var t=this.value,a=dt(t,e.transform);null!==a&&(e.center[0]=a),e.transform=t,E.set(e),p.reload(e)}function b(){var t=this;t&&(e.projection=t.value,E.set(e),p.reproject(e))}function w(){!1!==ct(this)&&!1!==x()&&p.rotate(e)}function x(){var t=mt("centerx"),a=mt("centery"),n=mt("centerz");if(t&&a){if("equatorial"!==e.transform)e.center[0]=parseFloat(t.value);else{var r=parseFloat(t.value);e.center[0]=r>12?15*r-360:15*r}e.center[1]=parseFloat(a.value);var s=parseFloat(n.value);return e.center[2]=isNaN(s)?0:s,""!==t.value&&""!==a.value}}function z(t){var e=d3.time.format("%Y%m%dT%H%M%S%Z"),a="d3-celestial",n=p.date();return n&&(a+=e(n)),a+t}function T(){var t=this.value;t&&j(t)}function j(t){var e,a=[],n=O;if("---"===t)return p.constellation=null,1!==(e=p.zoomBy())&&a.push({param:"zoom",value:1/e,duration:0}),void p.animate(a,!1);if(function(t){var e=typeof t;return"function"===e||"object"===e&&!!t}(p.constellations)&&Y(p.constellations,t)){var r=p.constellations[t],s=k(r.center,S[n.transform]);n.center=s,ut(n.center,n.transform),1!==(e=p.zoomBy())&&a.push({param:"zoom",value:1/e,duration:0}),a.push({param:"center",value:s,duration:0});var o=1+360/r.scale;a.push({param:"zoom",value:o,duration:0}),p.constellation=t,p.animate(a,!1)}}function P(){var t,a=this;switch(Object.assign(e,E.set()),a.type){case"checkbox":t=a.checked,ot(a);break;case"number":if(!1===ct(a))return;t=parseFloat(a.value);break;case"color":if(!1===pt(a))return;t=a.value;break;case"text":if(-1===a.id.search(/fill$/))return;if(!1===pt(a))return;t=a.value;break;case"select-one":t=a.value}null!==t&&(A(a.id,t),"dsos-style-fill"===a.id?(A("dsos-style-stroke",t),A("dsos-nameStyle-fill",t)):"constellations-namesType"===a.id?ht():"lang"===a.id?I(t):"advanced"===a.id&&ft(t),x(),Object.assign(O,e),p.apply(e))}function A(t,a){var n=t.split("-");switch(n.length){case 1:e[n[0]]=a;break;case 2:e[n[0]][n[1]]=a;break;case 3:e[n[0]][n[1]][n[2]]=a;break;default:return}}function I(t){Object.assign(e,O),e.lang=t;for(var a=["constellations","planets"],n=0;n<a.length;n++)Y(B[a[n]][e.culture].names,t)?e[a[n]].namesType=t:Y(B[a[n]][e.culture].names,"desig")?e[a[n]].namesType="desig":e[a[n]].namesType="name";return Y(B.dsonames[e.culture].names,t)?e.dsos.namesType=t:e.dsos.namesType="desig",Y(B.starnames[e.culture].propername,t)?e.stars.propernameType=t:e.stars.propernameType="desig",Object.assign(O,e),L(),ht(),e}function L(){d3.selectAll(s+" ~ #celestial-form input, "+s+" ~  #celestial-form select").each((function(t,a){if(void 0!==this){var n=this.id;if("lat"===n||"lon"===n)K(e.geopos)&&(this.value="lat"===n?e.geopos[0]:e.geopos[1]);else if(-1!==n.search(/center/)){if(K(e.center))switch(n){case"centerx":this.value=e.center[0];break;case"centery":this.value=e.center[1];break;case"centerz":this.value=e.center[2]||0}}else{if("datetime"===n||"hr"===n||"min"===n||"sec"===n||"tz"===n)return;if("button"!==this.type){var r=q(n);switch(this.type){case"checkbox":this.checked=r,ot(n);break;case"number":if(!1===ct(this))break;this.value=parseFloat(q(n));break;case"color":if(!1===pt(this))break;this.value=r;break;case"text":if(-1===n.search(/fill$/))break;if(!1===pt(this))break;this.value=r;break;case"select-one":this.value=r}}}}}))}function q(t){var a=t.split("-");switch(a.length){case 1:return e[a[0]];case 2:return e[a[0]][a[1]];case 3:return e[a[0]][a[1]][a[2]];default:return}}c=0,i.append("label").attr("title","General language setting").attr("for","lang").html("Object names "),l=i.append("select").attr("id","lang").on("change",P),d=g.map((function(t,a){return t===e.lang&&(c=a),{o:t,n:B.constellations[e.culture].names[t]}})),d=[{o:"---",n:"(Select language)"}].concat(d),l.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),l.property("selectedIndex",c),(i=o.append("div").attr("class","col").attr("id","download")).append("label").attr("class","header").html("Download"),i.append("input").attr("type","button").attr("id","download-png").attr("value","PNG Image").on("click",(function(){var t=d3.select("body").append("a").node(),e=document.querySelector(s+" canvas");t.download=z(".png"),t.rel="noopener",t.href=e.toDataURL("image/png").replace("image/png","image/octet-stream"),t.click(),d3.select(t).remove()})),i.append("input").attr("type","button").attr("id","download-svg").attr("value","SVG File").on("click",(function(){return St(z(".svg")),!1})),function(){var t,e,a,n=/\d+(\.\d+)?/g,r={s:6,d:6},s=p.settings();a=s.dsos.data,null!==(t=a.match(n))&&(r.d=parseFloat(t[t.length-1]));6!==r.d&&(mt("dsos-limit").max=r.d,mt("dsos-nameLimit").max=r.d);e=s.stars.data,null!==(t=e.match(n))&&(r.s=parseFloat(t[t.length-1]));6!=r.s&&(mt("stars-limit").max=r.s,mt("stars-designationLimit").max=r.s,mt("stars-propernameLimit").max=r.s)}(),dt(e.transform),function(t,e){var a,n;if(!Y(t,"formFields"))return;if(e&&Y(t.formFields,e))return void d3.select(s+" ~ #celestial-form").select("#"+e).style({display:"none"});if(!1===t.form&&!0===t.location){for(n in d3.select(s+" ~ #celestial-form").style("display","inline-block"),t.formFields)Y(t.formFields,n)&&"location"!==n&&d3.select(s+" ~ #celestial-form").select("#"+n).style({display:"none"});return}!1===t.form&&d3.select(s+" ~ #celestial-form").style("display","none");for(n in t.formFields)Y(t.formFields,n)&&"location"!==n&&(a=!1===t.formFields[n]?"none":"block",d3.select(s+" ~ #celestial-form").select("#"+n).style({display:a}))}(t),ft(e.advanced),p.updateForm=L,p.showConstellation=j,p.setLanguage=function(t){var a=E.set();return-1!==G[e.culture].indexOf(t)&&(a=I(t)),a}}(n),null===W("error")&&d3.select("body").append("div").attr("id","error"),null===W("loc")?function(t){var e=d3.time.format("%Y-%m-%d %H:%M:%S"),a=[0,0],n=[0,0],r=new Date,o=-r.getTimezoneOffset(),i=o,l=E.set(t),c=d3.select(s+" ~ #celestial-form form").insert("div","div#general").attr("id","loc"),d=new jt(l,(function(t,e){mt("datetime").value=x(t,e),i=e,P()}));Y(l,"geopos")&&null!==l.geopos&&2===l.geopos.length&&(n=l.geopos);var u=c.append("div").attr("class","col").attr("id","location").style("display","none");u.append("label").attr("title","Location coordinates long/lat").attr("for","lat").html("Location"),u.append("input").attr("type","number").attr("id","lat").attr("title","Latitude").attr("placeholder","Latitude").attr("max","90").attr("min","-90").attr("step","0.0001").attr("value",n[0]).on("change",(function(){!0===ct(this)&&P()})),u.append("span").html("\xb0"),u.append("input").attr("type","number").attr("id","lon").attr("title","Longitude").attr("placeholder","Longitude").attr("max","180").attr("min","-180").attr("step","0.0001").attr("value",n[1]).on("change",(function(){!0===ct(this)&&P()})),u.append("span").html("\xb0"),"geolocation"in navigator&&u.append("input").attr("type","button").attr("value","Here").attr("id","here").on("click",w);u.append("label").attr("title","Local date/time").attr("for","datetime").html(" Date/time"),u.append("input").attr("type","button").attr("id","day-left").attr("title","One day back").on("click",(function(){r.setDate(r.getDate()-1),mt("datetime").value=x(r,i),P()})),u.append("input").attr("type","text").attr("id","datetime").attr("title","Date and time").attr("value",x(r,i)).on("click",k,!0).on("input",(function(){this.value=x(r,i),d.isVisible()||k()})),u.append("div").attr("id","datepick").on("click",k),u.append("input").attr("type","button").attr("id","day-right").attr("title","One day forward").on("click",(function(){r.setDate(r.getDate()+1),mt("datetime").value=x(r,i),P()})),u.append("input").attr("type","button").attr("value","Now").attr("id","now").on("click",b),u.append("br"),u.append("label").attr("title","Show horizon marker").attr("for","horizon-show").html(" Horizon marker"),u.append("input").attr("type","checkbox").attr("id","horizon-show").property("checked",l.horizon.show).on("change",j),u.append("label").attr("title","Show daylight").attr("for","daylight-show").html("Daylight sky"),u.append("input").attr("type","checkbox").attr("id","daylight-show").property("checked",l.daylight.show).on("change",j),u.append("br"),u.append("label").attr("title","Show solar system objects").attr("for","planets-show").html(" Planets, Sun & Moon"),u.append("input").attr("type","checkbox").attr("id","planets-show").property("checked",l.planets.show).on("change",j);var f=B.planets[l.culture]||B.planets.iau;for(var h in f)if(Y(f,h)){var m=Object.keys(f[h]);if(m.length>1){var y="symbol"===h?"as":"with";u.append("label").attr("for","planets-"+h+"Type").html(y);var g=0;u.append("label").attr("title","Type of planet name").attr("for","planets-"+h+"Type").attr("class","advanced").html("");var v=u.append("select").attr("id","planets-"+h+"Type").on("change",j),M=m.map((function(t,e){return t===l.planets[h+"Type"]&&(g=e),{o:t,n:f[h][t]}}));v.selectAll("option").data(M).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),v.property("selectedIndex",g),"names"===h&&(v.attr("class","advanced"),u.append("label").attr("for","planets-"+h).html("names"),u.append("input").attr("type","checkbox").attr("id","planets-"+h).property("checked",l.planets[h]).on("change",j))}}function b(){r.setTime(Date.now()),mt("datetime").value=x(r,i),P()}function w(){navigator.geolocation.getCurrentPosition((function(t){n=[R(t.coords.latitude,4),R(t.coords.longitude,4)],mt("lat").value=n[0],mt("lon").value=n[1],P()}))}function k(){d.show(r,i)}function x(t,a){var n;if(a&&"0"!==a){var r=Math.floor(Math.abs(a)/60),s=Math.abs(a)-60*r;n=(a>0?" +":" \u2212")+$(r)+$(s)}else n=" \xb10000";return e(t)+n}function S(t){return!(!t||!K(t)||t.length<2)&&(!(!J(t[0])||t[0]<-90||t[0]>90)&&!(!J(t[1])||t[1]<-180||t[1]>180))}function T(t){return void 0!==t&&null!==t&&!(!J(t)&&Math.abs(t)>840)}function j(){Object.assign(l,E.set()),l.horizon.show=!!mt("horizon-show").checked,l.daylight.show=!!mt("daylight-show").checked,l.planets.show=!!mt("planets-show").checked,l.planets.names=!!mt("planets-names").checked,l.planets.namesType=mt("planets-namesType").value,l.planets.symbolType=mt("planets-symbolType").value,ot(mt("planets-show")),p.apply(l)}function P(){var t=parseFloat(mt("lon").value),s=parseFloat(mt("lat").value);if(Object.assign(l,E.set()),r=e.parse(mt("datetime").value.slice(0,-6)),!isNaN(t)&&!isNaN(s)){if(s!==n[0]||t!==n[1])return n=[s,t],void A([s,t],!0);mt("datetime").value=x(r,i);var c=new Date(r.valueOf()-6e4*(i-o));(a=p.getPoint(z.inverse(c,[90,0],n),l.transform))[2]=0,"zenith"===l.follow?p.rotate({center:a}):p.redraw()}}function A(t,e){if(t&&Y(l,"settimezone")&&!1!==l.settimezone){var a=Math.floor(r.getTime()/1e3),n=(window&&"https:"===window.location.protocol?"https":"http")+"://api.timezonedb.com/v2.1/get-time-zone?key="+l.timezoneid+"&format=json&by=position&lat="+t[0]+"&lng="+t[1]+"&time="+a;d3.json(n,(function(e,n){if(e)return console.warn(e);"FAILED"===n.status?(i=60*Math.round(t[1]/15),{gmtOffset:60*i,message:"Sea locatation inferred",timestamp:a}):(i=n.gmtOffset/60,n),mt("datetime").value=x(r,i),P()}))}}ot(mt("planets-show")),ft(l.advanced),d3.select(document).on("mousedown",(function(){!function(t,e){for(;t.parentNode;){if(t.id===e)return!0;t=t.parentNode}return!1}(d3.event.target,"celestial-date")&&d.isVisible()&&d.hide()})),p.dateFormat=x,p.date=function(t,e){if(!t)return r;T(e)&&(i=e),Object.assign(l,E.set()),d.isVisible()&&d.hide(),r.setTime(t.valueOf()),mt("datetime").value=x(t,i),P()},p.timezone=function(t){if(!t)return i;T(t)&&(i=t),Object.assign(l,E.set()),d.isVisible()&&d.hide(),mt("datetime").value=x(r,i),P()},p.position=function(){return n},p.location=function(t,e){if(!t||t.length<2)return n;S(t)&&(n=t.slice(),mt("lat").value=n[0],mt("lon").value=n[1],T(e)?i=e:A(n,!0))},p.skyview=function(t){if(!t)return{date:r,location:n,timezone:i};var e,a=!1;if(d.isVisible()&&d.hide(),Y(t,"timezone")&&T(t.timezone)&&(i=t.timezone,a=!0),Y(t,"date")&&((e=t.date)&&e instanceof Date&&!isNaN(e))&&(r.setTime(t.date.valueOf()),mt("datetime").value=x(t.date,i),a=!0),!Y(t,"location")||!S(t.location)||(n=t.location.slice(),mt("lat").value=n[0],mt("lon").value=n[1],Y(t,"timezone")))return!1===a?{date:r,location:n,timezone:i}:void("zenith"===l.follow?P():p.redraw());A(n,!Y(t,"date"))},p.dtLoc=p.skyview,p.zenith=function(){return a},p.nadir=function(){var t=-a[1],e=a[0]+180;return e>180&&(e-=360),[e,t-.001]},!Y(l,"formFields")||!0!==l.location&&!0!==l.formFields.location||d3.select(s+" ~ #celestial-form").select("#location").style({display:"inline-block"});!S(n)||!0!==l.location&&!0!==l.formFields.location||"zenith"!==l.follow||setTimeout(P,1e3)}(n):!0===n.location&&"zenith"===n.follow&&At({center:p.zenith()}),!0!==n.location&&!0!==n.formFields.location||(d3.select(s+" #location").style("display","inline-block"),it("horizon-show",Z.clip),it("daylight-show",!Z.clip)),this.container=a,this.clip=Ft,this.map=i,this.mapProjection=r,this.context=wt,this.metrics=function(){return{width:F,height:tt,margin:D,scale:r.scale()}},this.setStyle=_t,this.setTextStyle=Ot,this.setStyleA=Et,this.setConstStyle=function(t,e){var a=N(e);wt.font=a[t]},this.symbol=U.symbol,this.dsoSymbol=Bt,this.redraw=qt,this.resize=function(t){return void 0!==t&&(Y(t,"width")?n.width=t.width:J(t)&&(n.width=t)),It(!0),n.width},this.reload=function(t){var e;t&&Object.assign(n,E.set(t)),"center"===n.follow&&Y(n,"center")?e=x(n.center):"zenith"===n.follow&&(e=x(p.zenith())),e&&r.rotate(e),a.selectAll(s+" *").remove(),zt()},this.apply=function(t){Pt(t)},this.reproject=function(t){return Lt(t)},this.rotate=function(t){return t?At(t):n.center},this.zoomBy=function(t){return t?Tt(t):r.scale()/at},this.color=function(t){return t&&Y(n.dsos.symbols,t)?n.dsos.symbols[t].fill:"#000"},this.starColor=Gt,this.animate=function(t,e){t&&(m=t,y=0,g=!!e,Rt())},this.stop=function(t){clearTimeout(e),!0===t&&(m=[])},this.go=function(t){m.length<1||(t&&t<m.length&&(y=t),Rt())},zt()}function zt(){for(var t in Nt(Z.clip),a.append("path").datum(xt.outline).attr("class","outline"),a.append("path").datum(l).attr("class","horizon"),a.append("path").datum(c).attr("class","daylight"),"equatorial"===n.transform?xt.minorStep([15,10]):xt.minorStep([10,10]),n.lines)Y(n.lines,t)&&("graticule"===t?(a.append("path").datum(xt).attr("class","graticule"),Y(n.lines.graticule,"lon")&&n.lines.graticule.lon.pos.length>0&&a.selectAll(s+" .gridvalues_lon").data(q("lon",n.lines.graticule.lon.pos)).enter().append("path").attr("class","graticule_lon"),Y(n.lines.graticule,"lat")&&n.lines.graticule.lat.pos.length>0&&a.selectAll(s+" .gridvalues_lat").data(q("lat",n.lines.graticule.lat.pos)).enter().append("path").attr("class","graticule_lat")):a.append("path").datum(d3.geo.circle().angle([90]).origin(k(v[t],S[n.transform]))).attr("class",t));d3.json(vt+"mw.json",(function(t,e){if(t)return window.alert("Data file could not be loaded or doesn't exist. See readme.md"),console.warn(t);var r=P(e,n.transform),o=I(r);a.selectAll(s+" .mway").data(r.features).enter().append("path").attr("class","mw"),a.selectAll(s+" .mwaybg").data(o.features).enter().append("path").attr("class","mwbg"),qt()})),d3.json(vt+Ct("constellations"),(function(t,e){if(t)return console.warn(t);var r=P(e,n.transform);a.selectAll(s+" .constnames").data(r.features).enter().append("text").attr("class","constname"),p.constellations=function(t){for(var e={},a=t.features,n=0;n<a.length;n++)e[a[n].id]={center:a[n].properties.display.slice(0,2),scale:a[n].properties.display[2]};return e}(r),qt()})),d3.json(vt+Ct("constellations","borders"),(function(t,e){if(t)return console.warn(t);var r=P(e,n.transform);a.selectAll(s+" .bounds").data(r.features).enter().append("path").attr("class","boundaryline"),qt()})),d3.json(vt+Ct("constellations","lines"),(function(t,e){if(t)return console.warn(t);var r=P(e,n.transform);a.selectAll(s+" .lines").data(r.features).enter().append("path").attr("class","constline"),ht(),qt()})),d3.json(vt+n.stars.data,(function(t,e){if(t)return console.warn(t);var r=P(e,n.transform);a.selectAll(s+" .stars").data(r.features).enter().append("path").attr("class","star"),qt()})),d3.json(vt+Ct("starnames"),(function(t,e){if(t)return console.warn(t);Object.assign(f,e),qt()})),d3.json(vt+n.dsos.data,(function(t,e){if(t)return console.warn(t);var r=P(e,n.transform);a.selectAll(s+" .dsos").data(r.features).enter().append("path").attr("class","dso"),qt()})),d3.json(vt+Ct("dsonames"),(function(t,e){if(t)return console.warn(t);Object.assign(h,e),qt()})),d3.json(vt+Ct("planets"),(function(t,e){if(t)return console.warn(t);var r=function(t){var e=[];for(var a in t)if(Y(t,a)&&-1!==n.planets.which.indexOf(a)){var r=kt().id(a);Y(t[a],"parent")&&r.parentBody(t[a].parent),r.elements(t[a].elements[0]).params(t[a]),"ter"===a?p.origin=r:e.push(r)}return e}(e,n.transform);a.selectAll(s+" .planets").data(r).enter().append("path").attr("class","planet"),qt()})),p.data.length>0&&p.data.forEach((function(t){Y(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)}),this),n.lang&&""!=n.lang&&Pt(p.setLanguage(n.lang))}function Tt(t){if(t&&1!==t){var e=r.scale(),a=e*t,s=o.scaleExtent(),i=1500*Math.sqrt(Math.abs(1-t));if(a<s[0]&&(a=s[0]),a>s[1]&&(a=s[1]),!0===n.disableAnimations)return r.scale(a),o.scale(a),qt(),0;var l=d3.interpolateNumber(e,a);return d3.select({}).transition().duration(i).tween("scale",(function(){return function(t){var e=l(t);r.scale(e),qt()}})).transition().duration(0).tween("scale",(function(){o.scale(a),qt()})),i}}function Pt(t){n=E.set(t),qt()}function At(t){var e,a,s,o=n.center,i=r.rotate(),l=r.scale(),c=2e3,p=!1,d=n.orientationfixed;R(i[1],1)===-R(t.center[1],1)&&(p=!0),n=n.set(t);var u=R(d3.geo.distance(o,n.center),2),f=d3.geo.distance([o[2],0],[n.center[2],0]);return u<.035&&f<.035||!0===n.disableAnimations?(gt=x(n.center),r.rotate(gt),qt(),0):(a=l>1.4*at?d3.interpolateNumber(l,at):function(){return l},s=0===f?function(){return i[2]}:function(t,e,a){t=(t*w+M)%M,e=(e*w+M)%M,Math.abs(t-e)>Math.PI&&(t>e?t-=M:e>t&&(e-=M));return d3.interpolateNumber(t/w,e/w)}(o[2],n.center[2]),u>3.14&&(n.center[0]-=.01),n.orientationfixed=!1,e=0===u?function(){return n.center}:d3.geo.interpolate(o,n.center),c=0!==u?c*u:c*f,d3.select({}).transition().duration(c).tween("center",(function(){return function(t){var n=x(e(t));n[2]=s(t);var o=a(t<.5?t:1-t);p&&(n[1]=i[1]),r.scale(o),r.rotate(n),qt()}})).transition().duration(0).tween("center",(function(){n.orientationfixed=d,gt=x(n.center),r.rotate(gt),qt()})),c)}function It(t){F=Wt(),(n.width!==F||t)&&(tt=F/X,_=J(n.background.width)?F+n.background.width:F,et=Math.round(_/X),at=Z.scale*F/1024,Mt.style("width",V(_)).style("height",V(et)).attr("width",_*Q).attr("height",et*Q),o.scaleExtent([at,at*d]).scale(at*u),r.translate([_/2,et/2]).scale(at*u),T&&(T.style.height=V(tt)),at*=u,qt())}function Lt(t){var e=Vt(t.projection,t.projectionRatio);if(e){var a=r.rotate(),s=r.center(),l=r.scale(),c=o.scaleExtent(),f=p.projection(n.projection).center(s).translate([_/2,et/2]).scale([c[0]]),h=2500,m=0,y=d3.interpolateNumber(X,e.ratio);Z.clip==e.clip&&!0!==n.disableAnimations||(h=0),Nt(e.clip);var g=p.projection(t.projection).center(s).translate([_/2,_/e.ratio/2]).scale([e.scale*F/1024]),v=n.adaptable;return l>c[0]?(m=Tt(.1),setTimeout(Lt,m,t),m+h):((n.location||n.formFields.location)&&(it("horizon-show",e.clip),it("daylight-show",!e.clip)),r=function(t,e){var a,n=d3.geo.projection(o).scale(1),r=n.center,s=n.translate;function o(n,r){var s=t([n*=180/Math.PI,r*=180/Math.PI]),o=e([n,r]);return[(1-a)*s[0]+a*o[0],(a-1)*s[1]-a*o[1]]}return n.alpha=function(o){if(!arguments.length)return a;a=+o;var i=t.center(),l=e.center(),c=t.translate(),p=e.translate();return r([(1-a)*i[0]+a*l[0],(1-a)*i[1]+a*l[1]]),s([(1-a)*c[0]+a*p[0],(1-a)*c[1]+a*p[1]]),n},delete n.translate,delete n.center,n.alpha(0)}(f,g),n.adaptable=!1,d3.select({}).transition().duration(h).tween("projection",(function(){return function(t){r.alpha(t).rotate(a),i.projection(r),Nt(e.clip),X=y(t),tt=F/X,Mt.style("width",V(_)).style("height",V(et)).attr("width",_*Q).attr("height",et*Q),T&&(T.style.height=V(et)),qt()}})).transition().duration(0).tween("projection",(function(){X=(Z=e).ratio,tt=F/Z.ratio,et=J(n.background.width)?tt+n.background.width:tt,at=Z.scale*F/1024,Mt.style("width",V(_)).style("height",V(et)).attr("width",_*Q).attr("height",et*Q),T&&(T.style.height=V(et)),n.projection=t.projection,r=p.projection(t.projection).rotate(a).translate([_/2,et/2]).scale(at*u),i.projection(r),Nt(Z.clip),o.projection(r).scaleExtent([at,at*d]).scale(at*u),n.adaptable=v,at*=u,qt()})),h)}}function qt(){var t=r.rotate();for(var e in wt.setTransform(Q,0,0,Q,0,0),n.adaptable&&(yt=Math.sqrt(r.scale()/at)),yt||(yt=1),nt=n.stars.size,st=n.stars.exponent,rt=n.dsos.size||nt,lt=n.dsos.exponent,n.orientationfixed&&n.center.length>2&&(t[2]=n.center[2],r.rotate(t)),n.center=[-t[0],-t[1],t[2]],ut(n.center,n.transform),wt.clearRect(0,0,_+D[0],et+D[1]),Dt(),n.mw.show&&(a.selectAll(s+" .mw").each((function(t){_t(n.mw.style),i(t),wt.fill()})),"supergalactic"!==n.transform&&n.background.opacity>.95&&a.selectAll(s+" .mwbg").each((function(t){_t(n.background),i(t),wt.fill()}))),n.lines)Y(n.lines,e)&&!0===n.lines[e].show&&(_t(n.lines[e]),a.selectAll(s+" ."+e).attr("d",i),wt.stroke());if(Y(n.lines.graticule,"lon")&&(Ot(n.lines.graticule.lon),a.selectAll(s+" .graticule_lon").each((function(t,e){if(Ft(t.geometry.coordinates)){var a=r(t.geometry.coordinates);Ut(a,t.properties.orientation),wt.fillText(t.properties.value,a[0],a[1])}}))),Y(n.lines.graticule,"lat")&&(Ot(n.lines.graticule.lat),a.selectAll(s+" .graticule_lat").each((function(t,e){if(Ft(t.geometry.coordinates)){var a=r(t.geometry.coordinates);Ut(a,t.properties.orientation),wt.fillText(t.properties.value,a[0],a[1])}}))),n.constellations.bounds&&(a.selectAll(s+" .boundaryline").each((function(t){if(_t(n.constellations.boundStyle),p.constellation){var e=new RegExp("\\b"+p.constellation+"\\b");-1!==t.ids.search(e)&&(wt.lineWidth*=1.5,wt.globalAlpha=1,wt.setLineDash([]))}i(t),wt.stroke()})),wt.setLineDash([])),n.constellations.lines&&a.selectAll(s+" .constline").each((function(t){Et(t.properties.rank,n.constellations.lineStyle),i(t),wt.stroke()})),Dt(!0),n.constellations.names&&a.selectAll(s+" .constname").each((function(t){if(Ft(t.geometry.coordinates)){Et(t.properties.rank,n.constellations.nameStyle);var e=r(t.geometry.coordinates);wt.fillText(function(t){return t.properties[n.constellations.namesType]}(t),e[0],e[1])}})),n.stars.show&&(_t(n.stars.style),a.selectAll(s+" .star").each((function(t){if(Ft(t.geometry.coordinates)&&t.properties.mag<=n.stars.limit){var e=r(t.geometry.coordinates),a=function(t){var e=t.properties.mag;if(null===e)return.1;var a=nt*yt*Math.exp(st*(e+2));return Math.max(a,.1)}(t);wt.fillStyle=Gt(t),wt.beginPath(),wt.arc(e[0],e[1],a,0,2*Math.PI),wt.closePath(),wt.fill(),n.stars.designation&&t.properties.mag<=n.stars.designationLimit*yt&&(Ot(n.stars.designationStyle),wt.fillText((s=t.id,Y(f,s)?f[s][n.stars.designationType]:""),e[0]+a,e[1])),n.stars.propername&&t.properties.mag<=n.stars.propernameLimit*yt&&(Ot(n.stars.propernameStyle),wt.fillText(function(t){var e=n.stars.propernameType;return Y(f,t)?Y(f[t],e)?f[t][e]:f[t].name:""}(t.id),e[0]-a,e[1]))}var s}))),n.dsos.show&&a.selectAll(s+" .dso").each((function(t){if(Ft(t.geometry.coordinates)&&Ht(t.properties,n.dsos.limit)){var e=r(t.geometry.coordinates),a=t.properties.type;!0===n.dsos.colors?_t(n.dsos.symbols[a]):_t(n.dsos.style);var s=Bt(t,e);Y(n.dsos.symbols[a],"stroke")?wt.stroke():wt.fill(),n.dsos.names&&Ht(t.properties,n.dsos.nameLimit*yt)&&(Ot(n.dsos.nameStyle),!0===n.dsos.colors&&(wt.fillStyle=n.dsos.symbols[a].fill),wt.fillText(function(t){var e=n.dsos.namesType,a=t.id;return"desig"!==e&&Y(h,a)&&Y(h[a],e)?h[a][e]:t.properties.desig}(t),e[0]+s,e[1]-s))}})),(n.location||n.formFields.location)&&n.planets.show&&p.origin){var o=p.date(),u=p.origin(o).spherical();a.selectAll(s+" .planet").each((function(t){var e=t.id(),a=12*yt,s=t(o).equatorial(u),i=k(s.ephemeris.pos,S[n.transform]);if(Ft(i)){var l=r(i),c=n.planets.symbols[e];if("letter"===n.planets.symbolType?(Ot(n.planets.symbolStyle),wt.fillStyle=c.fill,wt.fillText(c.letter,l[0],l[1])):"lun"===e?(Y(c,"size")&&J(c.size)&&(a=c.size*yt),wt.fillStyle=c.fill,U.symbol().type("crescent").size(a*a).age(s.ephemeris.age).position(l)(wt)):"disk"===n.planets.symbolType?(a=Y(c,"size")&&J(c.size)?c.size*yt:function(t){var e=t.mag;if(null===e)return 2;var a=4*yt*Math.exp(-.05*(e+2));return Math.max(a,2)}(s.ephemeris),wt.fillStyle=c.fill,U.symbol().type("circle").size(a*a).position(l)(wt),wt.fill()):"symbol"===n.planets.symbolType&&(Ot(n.planets.symbolStyle),wt.font=function(t){var e=t.replace(/(^\D*)(\d+)(\D.+$)/i,"$2");return e=Math.round(yt*e),t.replace(/(^\D*)(\d+)(\D.+$)/i,"$1"+e+"$3")}(n.planets.symbolStyle.font),wt.fillStyle=c.fill,wt.fillText(c[n.planets.symbolType],l[0],l[1])),n.planets.names){var p=s[n.planets.namesType];Ot(n.planets.nameStyle),wt.fillStyle=c.fill,wt.fillText(p,l[0]-a/2,l[1]+a/2)}}}))}if(p.data.length>0&&p.data.forEach((function(t){t.redraw()})),(n.location||n.formFields.location)&&n.daylight.show&&Z.clip){var m=A("sol");if(m){var y=p.zenith(),g=m.ephemeris.pos,v=d3.geo.distance(y,g),M=r(g);c.origin(g),function(t,e){var a,n,r,s,o=1.36,i=1.885;if(t>i)return wt.fillStyle="transparent",void(wt.globalAlpha=0);t<=o?(n="#daf1fa",r="#93d7f0",s="#57c0e8",a=-(o-t)/10):(a=(t-o)/(i-o),n=d3.interpolateLab("#daf1fa","#e8c866")(a),r=d3.interpolateLab("#93c7d0","#ff854a")(a),s=d3.interpolateLab("#57b0c8","#6caae2")(a));var l=wt.createRadialGradient(e[0],e[1],0,e[0],e[1],300);l.addColorStop(0,n),l.addColorStop(.2+.4*a,r),l.addColorStop(1,s),wt.fillStyle=l,wt.globalAlpha=.9*(1-(c=a,p=1.4,(Math.pow(Math.E,c*p)-1)/(Math.pow(Math.E,p)-1)));var c,p}(v,M),a.selectAll(s+" .daylight").datum(c).attr("d",i),wt.fill(),wt.fillStyle="#fff",Ft(g)&&(wt.beginPath(),wt.arc(M[0],M[1],6,0,2*Math.PI),wt.closePath(),wt.fill())}}(n.location||n.formFields.location)&&n.horizon.show&&!Z.clip&&(l.origin(p.nadir()),_t(n.horizon),a.selectAll(s+" .horizon").datum(l).attr("d",i),wt.fill(),n.horizon.stroke&&wt.stroke()),n.controls&&function(t){var e=W("celestial-zoomin"),a=W("celestial-zoomout"),n=Z.scale*F/1024;if(!e||!a)return;e.disabled=t>=n*d*.99,a.disabled=t<=n}(r.scale()),j&&p.runCallback()}function Dt(e){var o=r.rotate();Vt(n.projection,t.projectionRatio);r.rotate([0,0]),_t(n.background),a.selectAll(s+" .outline").attr("d",i),!0===e?(wt.globalAlpha=1,wt.stroke()):wt.fill(),r.rotate(o)}function Ft(t){return Z.clip&&d3.geo.distance(n.center,t)>b?0:1}function _t(t){wt.fillStyle=t.fill||null,wt.strokeStyle=t.stroke||null,wt.lineWidth=t.width||null,wt.globalAlpha=null!==t.opacity?t.opacity:1,wt.font=t.font||null,Y(t,"dash")?wt.setLineDash(t.dash):wt.setLineDash([]),wt.beginPath()}function Ot(t){wt.fillStyle=t.fill,wt.textAlign=t.align||"left",wt.textBaseline=t.baseline||"bottom",wt.globalAlpha=null!==t.opacity?t.opacity:1,wt.font=t.font}function Et(t,e){t=t||1,wt.fillStyle=K(e.fill)?e.fill[t-1]:null,wt.strokeStyle=K(e.stroke)?e.stroke[t-1]:null,wt.lineWidth=K(e.width)?e.width[t-1]:null,wt.globalAlpha=K(e.opacity)?e.opacity[t-1]:1,wt.font=K(e.font)?e.font[t-1]:null,Y(e,"dash")?wt.setLineDash(e.dash):wt.setLineDash([]),wt.textAlign=e.align||"left",wt.textBaseline=e.baseline||"bottom",wt.beginPath()}function Nt(t){t?r.clipAngle(90):r.clipAngle(null)}function Ct(t,e,a){return t+(e=e?"."+e:"")+(Y(B[t],bt)?"."+bt:"")+(a=a?"."+a:".json")}function Ht(t,e){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>e||999!==t.mag&&t.mag<=e}function Bt(t,e){var a=t.properties,r=function(t){return t.mag&&999!==t.mag?Math.pow(2*rt*yt-t.mag,lt):Math.pow(parseInt(t.dim)*rt*yt/7,.5)}(a)||9,s=function(t){return t&&Y(n.dsos.symbols,t)?n.dsos.symbols[t].shape:"circle"}(a.type);return U.symbol().type(s).size(r).position(e)(wt),Math.sqrt(r)/2}function Gt(t){var e=t.properties.bv;return!n.stars.colors||isNaN(e)?n.stars.style.fill:C(e)}function Ut(t,e){for(var a=e.split(""),n="center",r="middle",s=a.length-1;s>=0;s--)switch(a[s]){case"N":r="bottom";break;case"S":r="top";break;case"E":n="left",t[0]+=2;break;case"W":n="right",t[0]-=2}return wt.textAlign=n,wt.textBaseline=r,t}function Wt(){return J(n.width)&&n.width>0?n.width:T?T.getBoundingClientRect().width-2*D[0]:window.getBoundingClientRect().width-2*D[0]}function Vt(t,e){if(Y(H,t)){var a=H[t];return Y(a,"ratio")||(a.ratio=2),a.ratio=e||a.ratio,a}}function Rt(){if(m&&!(m.length<1)){var t,a=m[y];switch(a.param){case"projection":t=Lt({projection:a.value});break;case"center":t=At({center:a.value});break;case"zoom":t=Tt(a.value)}a.callback&&setTimeout(a.callback,t),y++,!0===g&&y===m.length&&(y=0),t=0===a.duration||a.duration<t?t:a.duration,y<m.length&&(e=setTimeout(Rt,t))}}},t.exports){var m=a(23476),y=a(49432);t.exports={Celestial:function(){return p},d3:function(){return m},"d3.geo.projection":function(){return y}}}p.projection=function(t){var e,a,n;if(!Y(H,t))throw new Error("Projection not supported: "+t);return e=H[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,(n=function(t,e){return a(-t,e)}).invert=function(t,e){try{var n=a.invert(t,e);return n[0]=n&&-n[0],n}catch(r){console.log(r)}},d3.geo.projection(n)};var g={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},v={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};p.eulerAngles=function(){return g},p.poles=function(){return v};var M=2*Math.PI,b=Math.PI/2,w=Math.PI/180;function k(t,e){return function(t,e){var a,n,r,s,o,i,l,c,p,d,u=1e-5;if(!e)return t;(i=t[0])<0&&(i+=M);l=t[1],i-=e[0],s=e[1],o=e[2],a=Math.sin(l)*Math.sin(s)-Math.cos(l)*Math.cos(s)*Math.cos(i),Math.abs(a)<u&&(a=-Math.cos(l+s)+Math.cos(l)*Math.cos(s)*(1-Math.cos(i)));n=-Math.cos(l)*Math.sin(i),c=0!==a||0!==n?Math.atan2(n,a):i-Math.PI;(p=o+c)>Math.PI&&(p-=M);i%Math.PI===0?((d=l+Math.cos(i)*s)>b&&(d=Math.PI-d),d<-b&&(d=-Math.PI-d)):(r=Math.sin(l)*Math.cos(s)+Math.cos(l)*Math.sin(s)*Math.cos(i),Math.abs(r)>.99?(d=Math.abs(Math.acos(Math.sqrt(a*a+n*n))),r<0&&(d*=-1)):d=Math.asin(r));return[p,d]}(t.map((function(t){return t*w})),e).map((function(t){return t/w}))}function x(t){if(null===t||t.length<=0)return[0,0,0];var e=g.equatorial;return t[2]||(t[2]=0),[e[0]-t[0],e[1]-t[1],e[2]+t[2]]}var S={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map((function(t){return t*w})))},add:function(t,e){if(e&&t&&3===e.length&&!this.hasOwnProperty(t))return this[t]=e.map((function(t){return t*w})),this[t]}};S.init(),p.euler=function(){return S};var z=function(t,e,a){var n=T(t,a[1])-e[0];n<0&&(n+=360),n*=w;var r=e[1]*w,s=a[0]*w,o=Math.asin(Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos(n)),i=Math.acos((Math.sin(r)-Math.sin(o)*Math.sin(s))/(Math.cos(o)*Math.cos(s)));return Math.sin(n)>0&&(i=2*Math.PI-i),[o/w,i/w,0]};function T(t,e){var a=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=t.getUTCDate(),s=t.getUTCHours(),o=t.getUTCMinutes(),i=t.getUTCSeconds();1!=n&&2!=n||(a-=1,n+=12);var l=Math.floor(a/100),c=2-l+Math.floor(l/4)+Math.floor(365.25*a)+Math.floor(30.6001*(n+1))-730550.5+r+(s+o/60+i/3600)/24,p=c/36525,d=280.46061837+360.98564736629*c+387933e-9*p*p-p*p*p/3871e4+e;if(d>0)for(;d>360;)d-=360;else for(;d<0;)d+=360;return d}z.inverse=function(t,e,a){var n=e[0]*w,r=e[1]*w,s=a[0]*w,o=Math.asin(Math.sin(n)*Math.sin(s)+Math.cos(n)*Math.cos(s)*Math.cos(r)),i=((Math.sin(n)-Math.sin(o)*Math.sin(s))/(Math.cos(o)*Math.cos(s))).toFixed(6);return i=Math.acos(i),i/=w,[T(t,a[1])-i,o/w,0]},p.horizontal=z,p.ha=function(t,e,a){var n=T(t,e)-a;return n<180&&(n+=360),n};var j=!1;function P(t,e){if("equatorial"===e)return t;for(var a=S[e],n=t.features,r=0;r<n.length;r++)n[r].geometry.coordinates=L(n[r],a);return t}function A(t,e){if(e=e||p.date(),p.origin){var a,n=p.origin(e).spherical();return p.container.selectAll(".planet").each((function(r){t===r.id()&&(a=r(e).equatorial(n))})),a}}function I(t){var e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[]}}]},a=t.features[0].geometry.coordinates[0];e.features[0].geometry.coordinates[0]=[];for(var n=0;n<a.length;n++)e.features[0].geometry.coordinates[0][n]=a[n].slice().reverse();return e}function L(t,e){var a=[];switch(t.geometry.type){case"Point":a=k(t.geometry.coordinates,e);break;case"LineString":a.push(F(t.geometry.coordinates,e));break;case"MultiLineString":a=_(t.geometry.coordinates,e);break;case"Polygon":a.push(F(t.geometry.coordinates[0],e));break;case"MultiPolygon":a.push(_(t.geometry.coordinates[0],e))}return a}function q(t,e){var a=[];if(!e)return[];K(e)||(e=[e]);for(var r=0;r<e.length;r++)switch(e[r]){case"center":a="lat"===t?a.concat(D(t,n.center[0],"N")):a.concat(D(t,n.center[1],"S"));break;case"outline":a="lon"===t?(a=a.concat(D(t,n.center[1]-89.99,"S"))).concat(D(t,n.center[1]+89.99,"N")):(a=a.concat(D(t,n.center[0]-179.99,"E"))).concat(D(t,n.center[0]+179.99,"W"));break;default:if(J(e[r])){a="lat"===t?a.concat(D(t,e[r],"N")):a.concat(D(t,e[r],"S"));break}}return function(t){for(var e=[],a=0;a<t.length;a++){var n={type:"Feature",id:a,properties:{},geometry:{type:"Point"}};n.properties.value=t[a].value,n.properties.orientation=t[a].orientation,n.geometry.coordinates=t[a].coordinates,e.push(n)}return e}(a)}function D(t,e,a){var r,s,o,i,l,c=t,p=[],d=e;"equatorial"===n.transform&&"lon"===c&&(c="ra"),"ra"===c?(r=0,s=23,o=1):"lon"===c?(r=0,s=350,o=10):(r=-80,s=80,o=10);for(var u=r;u<=s;u+=o){var f=a;"lat"===c?(l=[d,u],i=u.toString()+"\xb0",f+=u<0?"S":"N"):"ra"===c?(l=[15*u,d],i=u.toString()+"\u02b0"):(l=[u,d],i=u.toString()+"\xb0"),p.push({coordinates:l,value:i,orientation:f})}return p}function F(t,e){for(var a=[],n=0;n<t.length;n++)a.push(k(t[n],e));return a}function _(t,e){for(var a=[],n=0;n<t.length;n++)a.push(F(t[n],e));return a}p.add=function(t){var e={};return Y(t,"type")?"dso"!==t.type&&"json"!==t.type||Y(t,"file")&&Y(t,"callback")?"line"!==t.type&&"raw"!==t.type||Y(t,"callback")?(Y(t,"file")&&(e.file=t.file),e.type=t.type,Y(t,"callback")&&(e.callback=t.callback),Y(t,"redraw")&&(e.redraw=t.redraw),Y(t,"save")&&(e.save=t.save),void p.data.push(e)):console.log("Can't add data"):console.log("Can't add data file"):console.log("Missing type")},p.remove=function(t){if(null!==t&&t<p.data.length)return p.data.splice(t,1)},p.clear=function(){p.data=[]},p.addCallback=function(t){p.callback=t,j=null!==t},p.runCallback=function(t){j=!1,p.callback(),j=!0},p.getData=P,p.getPoint=function(t,e){return k(t,S[e])},p.getPlanet=A;var O={},E={width:0,projection:"aitoff",projectionRatio:null,transform:"equatorial",center:null,geopos:null,follow:"zenith",orientationfixed:!0,zoomlevel:null,zoomextend:10,adaptable:!0,interactive:!0,disableAnimations:!1,form:!1,location:!1,formFields:{location:!0,general:!0,stars:!0,dsos:!0,constellations:!0,lines:!0,other:!0,download:!1},advanced:!0,daterange:[],settimezone:!0,timezoneid:"AEFXZPQ3FDPF",controls:!0,lang:"",culture:"",container:"celestial-map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},designation:!0,designationType:"desig",designationStyle:{fill:"#ddddbb",font:"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},designationLimit:2.5,propername:!1,propernameType:"name",propernameStyle:{fill:"#ddddbb",font:"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"right",baseline:"bottom"},propernameLimit:1.5,size:7,exponent:-.28,data:"stars.6.json"},dsos:{show:!0,limit:6,colors:!0,style:{fill:"#cccccc",stroke:"#cccccc",width:2,opacity:1},names:!0,namesType:"desig",nameStyle:{fill:"#cccccc",font:"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, serif",align:"left",baseline:"bottom"},nameLimit:4,size:null,exponent:1.4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ff9900",stroke:"#ff9900",width:2},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc"},sfr:{shape:"square",fill:"#cc00ff"},rn:{shape:"square",fill:"#0000ff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,namesType:"desig",nameStyle:{fill:"#cccc99",align:"center",baseline:"middle",opacity:.8,font:["14px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif","12px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif","11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif"]},lines:!0,lineStyle:{stroke:"#cccccc",width:1.5,opacity:.6},bounds:!1,boundStyle:{stroke:"#ccff00",width:1,opacity:.8,dash:[4,4]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8,lon:{pos:[],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"},lat:{pos:[],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"}},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},background:{fill:"#000000",opacity:1,stroke:"#000000",width:1.5},horizon:{show:!1,stroke:"#cccccc",width:1,fill:"#000000",opacity:.4},daylight:{show:!1},planets:{show:!1,which:["sol","mer","ven","ter","lun","mar","jup","sat","ura","nep","cer","plu"],symbols:{sol:{symbol:"\u2609",letter:"Su",fill:"#ffff00",size:12},mer:{symbol:"\u263f",letter:"Me",fill:"#cccccc"},ven:{symbol:"\u2640",letter:"V",fill:"#eeeecc"},ter:{symbol:"\u2295",letter:"T",fill:"#00ccff"},lun:{symbol:"\u25cf",letter:"L",fill:"#ffffff",size:12},mar:{symbol:"\u2642",letter:"Ma",fill:"#ff6600"},cer:{symbol:"\u26b3",letter:"C",fill:"#cccccc"},ves:{symbol:"\u26b6",letter:"Ma",fill:"#cccccc"},jup:{symbol:"\u2643",letter:"J",fill:"#ffaa33"},sat:{symbol:"\u2644",letter:"Sa",fill:"#ffdd66"},ura:{symbol:"\u2645",letter:"U",fill:"#66ccff"},nep:{symbol:"\u2646",letter:"N",fill:"#6666ff"},plu:{symbol:"\u2647",letter:"P",fill:"#aaaaaa"},eri:{symbol:"\u26aa",letter:"E",fill:"#eeeeee"}},symbolStyle:{fill:"#cccccc",opacity:1,font:"bold 20px 'DejaVu Sans Mono', 'Arial Unicode MS', sans-serif",align:"center",baseline:"middle"},symbolType:"symbol",names:!1,nameStyle:{fill:"#cccccc",font:"14px 'Lucida Sans Unicode', 'DejaVu Sans', sans-serif",align:"right",baseline:"top"},namesType:"en"},set:function(t){var e,a,n={},r={};if(0===Object.entries(O).length?Object.assign(n,this):Object.assign(n,O),!t)return n;for(e in n)if(Y(n,e))if(Y(t,e)&&null!==t[e])if(null===n[e]||n[e].constructor!=Object)r[e]=t[e];else for(a in r[e]={},n[e])Y(t[e],a)?r[e][a]=t[e][a]:r[e][a]=n[e][a];else r[e]=n[e];return r.constellations.nameStyle.font=N(r.constellations.nameStyle.font),r.constellations.nameStyle.opacity=N(r.constellations.nameStyle.opacity),r.constellations.nameStyle.fill=N(r.constellations.nameStyle.fill),r.constellations.lineStyle.width=N(r.constellations.lineStyle.width),r.constellations.lineStyle.opacity=N(r.constellations.lineStyle.opacity),r.constellations.lineStyle.stroke=N(r.constellations.lineStyle.stroke),Object.assign(O,r),r},applyDefaults:function(t){var e={};return Object.assign(e,O),e.stars.size=e.stars.size||7,e.stars.exponent=e.stars.exponent||-.28,(!e.center||e.center.length<=0)&&(e.center=[0,0,0]),e.datapath=e.datapath||"",e.datapath=e.datapath.replace(/([^\/]$)/,"$1/"),e.transform&&""!==e.transform||(e.transform="equatorial"),e.culture&&-1!==e.culture.search(/^cn$/)||(e.culture="iau"),t&&(Y(t,"stars")&&(Y(t.stars,"names")&&(e.stars.designation=t.stars.names),Y(t.stars,"namelimit")&&(e.stars.designationLimit=t.stars.namelimit),Y(t.stars,"namestyle")&&Object.assign(e.stars.designationStyle,t.stars.namestyle),Y(t.stars,"proper")&&(e.stars.propername=t.stars.proper),Y(t.stars,"propernamelimit")&&(e.stars.propernameLimit=t.stars.propernamelimit),Y(t.stars,"propernamestyle")&&Object.assign(e.stars.propernameStyle,t.stars.propernamestyle)),Y(t,"dsos")&&(Y(t.dsos,"desig")&&!0===t.dsos.desig&&(e.dsos.namesType="desig"),Y(t.dsos,"namelimit")&&(e.dsos.nameLimit=t.dsos.namelimit),Y(t.dsos,"namestyle")&&Object.assign(e.dsos.nameStyle,t.dsos.namestyle)),Y(t,"constellations")&&(Y(t.constellations,"show")&&!0===t.constellations.show&&(e.constellations.names=!0),Y(t.constellations,"desig")&&!0===t.constellations.desig&&(e.constellations.namesType="desig"),"latin"===e.constellations.namesType&&(e.constellations.namesType="la"),"iau"===e.constellations.namesType&&(e.constellations.namesType="name"),Y(t.constellations,"namestyle")&&Object.assign(e.constellations.nameStyle,t.constellations.namestyle),Y(t.constellations,"linestyle")&&Object.assign(e.constellations.lineStyle,t.constellations.linestyle),Y(t.constellations,"boundstyle")&&Object.assign(e.constellations.boundStyle,t.constellations.boundstyle)),Y(t,"planets")&&Y(t.planets,"style")&&Object.assign(e.planets.style,t.planets.symbolStyle)),e.stars.designationType&&""!==e.stars.designationType||(e.stars.designationType="desig"),Y(B.starnames[e.culture].designation,e.stars.designationType)||(e.designationType="desig"),e.stars.propernameType&&""!==e.stars.propernameType||(e.stars.propernameType="name"),Y(B.starnames[e.culture].propername,e.stars.propernameType)||(e.propernameType="name"),e.dsos.namesType&&""!==e.dsos.namesType||(e.dsos.namesType="desig"),e.constellations.namesType&&""!==e.constellations.namesType||(e.constellations.namesType="desig"),Y(B.constellations[e.culture].names,e.constellations.namesType)||(e.constellations.namesType="name"),e.planets.symbolType&&""!==e.planets.symbolType||(e.planets.symbolType="symbol"),e.planets.namesType&&""!==e.planets.namesType||(e.planets.namesType="desig"),Y(B.planets[e.culture].names,e.planets.namesType)||(e.planets.namesType="desig"),e.constellations.nameStyle.font=N(e.constellations.nameStyle.font),e.constellations.nameStyle.opacity=N(e.constellations.nameStyle.opacity),e.constellations.nameStyle.fill=N(e.constellations.nameStyle.fill),e.constellations.lineStyle.width=N(e.constellations.lineStyle.width),e.constellations.lineStyle.opacity=N(e.constellations.lineStyle.opacity),e.constellations.lineStyle.stroke=N(e.constellations.lineStyle.stroke),Object.assign(O,e),e}};function N(t){return K(t)?t.length>=3?t:1===t.length?[t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[1]]:void 0:[t,t,t]}p.settings=function(){return E};var C=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),H={airy:{n:"Airy\u2019s Minimum Error",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker Dinomic",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus Star",arg:0,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs Eumorphic",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/2.5,scale:225,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},cassini:{n:"Cassini",arg:null,scale:325,ratio:1,clip:!0},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig Retroazimuthal",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:"Craster Parabolic",arg:null,scale:160},cylindricalEqualArea:{n:"Cylindrical Equal Area",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:"Cylindrical Stereographic",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:"Eckert I",arg:null,scale:175},eckert2:{n:"Eckert II",arg:null,scale:175},eckert3:{n:"Eckert III",arg:null,scale:190},eckert4:{n:"Eckert IV",arg:null,scale:190},eckert5:{n:"Eckert V",arg:null,scale:182},eckert6:{n:"Eckert VI",arg:null,scale:182},eisenlohr:{n:"Eisenlohr",arg:null,scale:102},equirectangular:{n:"Equirectangular",arg:null,scale:165},fahey:{n:"Fahey",arg:null,scale:196,ratio:1.4},mtFlatPolarParabolic:{n:"Flat Polar Parabolic",arg:null,scale:175},mtFlatPolarQuartic:{n:"Flat Polar Quartic",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{n:"Flat Polar Sinusoidal",arg:null,scale:175,ratio:1.9},foucaut:{n:"Foucaut",arg:null,scale:142},ginzburg4:{n:"Ginzburg IV",arg:null,scale:180,ratio:1.7},ginzburg5:{n:"Ginzburg V",arg:null,scale:196,ratio:1.55},ginzburg6:{n:"Ginzburg VI",arg:null,scale:190,ratio:1.4},ginzburg8:{n:"Ginzburg VIII",arg:null,scale:205,ratio:1.3},ginzburg9:{n:"Ginzburg IX",arg:null,scale:190,ratio:1.4},homolosine:{n:"Goode Homolosine",arg:null,scale:160,ratio:2.2},hammer:{n:"Hammer",arg:2,scale:180},hatano:{n:"Hatano",arg:null,scale:186},healpix:{n:"HEALPix",arg:1,scale:320,ratio:1.2},hill:{n:"Hill Eucyclic",arg:2,scale:190,ratio:1.1},kavrayskiy7:{n:"Kavrayskiy VII",arg:null,scale:185,ratio:1.75},lagrange:{n:"Lagrange",arg:Math.PI/4,scale:88,ratio:1.6,clip:!1},larrivee:{n:"l'Arriv\xe9e",arg:null,scale:160,ratio:1.25},laskowski:{n:"Laskowski Tri-Optimal",arg:null,scale:165,ratio:1.7},loximuthal:{n:"Loximuthal",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:"Mercator",arg:null,scale:160,ratio:1.3},miller:{n:"Miller",arg:null,scale:160,ratio:1.5},mollweide:{n:"Mollweide",arg:null,scale:180},naturalEarth:{n:"Natural Earth",arg:null,scale:185,ratio:1.85},nellHammer:{n:"Nell Hammer",arg:null,scale:160,ratio:2.6},orthographic:{n:"Orthographic",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:"Patterson Cylindrical",arg:null,scale:160,ratio:1.75},polyconic:{n:"Polyconic",arg:null,scale:160,ratio:1.3},quincuncial:{n:"Quincuncial",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:"Rectangular Polyconic",arg:0,scale:160,ratio:1.65},robinson:{n:"Robinson",arg:null,scale:160},sinusoidal:{n:"Sinusoidal",arg:null,scale:160,ratio:2},stereographic:{n:"Stereographic",arg:null,scale:500,ratio:1,clip:!0},times:{n:"Times",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:"Two-Point Equidistant",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:"van Der Grinten",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:"van Der Grinten II",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:"van Der Grinten III",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:"van Der Grinten IV",arg:null,scale:160,ratio:1.6},wagner4:{n:"Wagner IV",arg:null,scale:185},wagner6:{n:"Wagner VI",arg:null,scale:160},wagner7:{n:"Wagner VII",arg:null,scale:190,ratio:1.8},wiechel:{n:"Wiechel",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:"Winkel Tripel",arg:null,scale:196,ratio:1.7}};p.projections=function(){return H};var B={starnames:{iau:{designation:{desig:"Designation",bayer:"Bayer",flam:"Flamsteed",var:"Variable",gl:"Gliese",hd:"Draper",hip:"Hipparcos"},propername:{name:"IAU Name",ar:"Arabic",zh:"Chinese",en:"English",fi:"Finnish",fr:"French",de:"German",el:"Greek",he:"Hebrew",hi:"Hindi",it:"Italian",ja:"Japanese",ko:"Korean",la:"Latin",fa:"Persian",ru:"Russian",es:"Spanish",tr:"Turkish"}},cn:{propername:{name:"Proper name",en:"English",pinyin:"Pinyin"},designation:{desig:"IAU Designation"}}},constellations:{iau:{names:{desig:"Designation",name:"IAU Name",ar:"Arabic",zh:"Chinese",cz:"Czech",en:"English",ee:"Estonian",fi:"Finnish",fr:"French",de:"German",el:"Greek",he:"Hebrew",hi:"Hindi",it:"Italian",ja:"Japanese",sw:"Kiswahili",ko:"Korean",la:"Latin",fa:"Persian",ru:"Russian",es:"Spanish",tr:"Turkish"}},cn:{names:{name:"Proper name",en:"English",pinyin:"Pinyin"}}},planets:{iau:{symbol:{symbol:"\u263e Symbol",letter:"\u216c Letter",disk:"\u25cf Disk"},names:{desig:"Designation",ar:"Arabic",zh:"Chinese",en:"English",fr:"French",de:"German",el:"Greek",he:"Hebrew",hi:"Hindi",it:"Italian",ja:"Japanese",ko:"Korean",la:"Latin",fa:"Persian",ru:"Russian",es:"Spanish"}},cn:{symbol:{symbol:"\u263e Symbol",letter:"\u216c Letter",disk:"\u25cf Disk"},names:{desig:"Designation",name:"Chinese",pinyin:"Pinyin",en:"English"}}},dsonames:{iau:{names:{desig:"Designation",name:"English",ar:"Arabic",zh:"Chinese",fi:"Finnish",fr:"French",de:"German",el:"Greek",hi:"Hindi",it:"Italian",ja:"Japanese",ko:"Korean",la:"Latin",fa:"Persian",ru:"Russian",es:"Spanish",tr:"Turkish"}},cn:{names:{desig:"Designation",name:"Chinese",pinyin:"Pinyin",en:"English"}}}},G={iau:Object.keys(B.constellations.iau.names).concat(Object.keys(B.planets.iau.names)).filter((function(t,e,a){return a.indexOf(t)===e})),cn:Object.keys(B.constellations.cn.names).concat(Object.keys(B.starnames.cn.propername)).filter((function(t,e,a){return a.indexOf(t)===e}))},U={};function W(t){return document.querySelector(s+" #"+t)}function V(t){return t+"px"}function R(t,e){return Math.round(Math.pow(10,e)*t)/Math.pow(10,e)}function $(t){return t<10?"0"+t:t}function Y(t,e){return null!==t&&hasOwnProperty.call(t,e)}function J(t){return null!==t&&!isNaN(parseFloat(t))&&isFinite(t)}function K(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)}function Q(t,e,a){var n=e.valueOf()-t.valueOf();switch(a||"d"){case"y":case"yr":n/=31556926080;break;case"m":case"mo":n/=26298e5;break;case"d":case"dy":n/=864e5;break;case"h":case"hr":n/=36e5;break;case"n":case"mn":n/=6e4;break;case"s":case"sec":n/=1e3}return Math.floor(n)}function Z(t){if(t){var e=t.split(".");if(!(e.length<1)&&((e=e[0].split("-"))[0]=e[0].replace(/\D/g,""),e[0]))return e[1]=e[1]?e[1].replace(/\D/g,""):"1",e[2]=e[2]?e[2].replace(/\D/g,""):"1",new Date(Date.UTC(e[0],e[1]-1,e[2]))}}U.symbol=function(){var t,e=d3.functor("circle"),a=d3.functor(64),n=d3.functor(Math.PI),r=(d3.functor("#fff"),d3.functor(""));d3.functor([2,2]);function s(t){o[e()](t)}var o={circle:function(e){var n=Math.sqrt(a())/2;return e.arc(t[0],t[1],n,0,2*Math.PI),e.closePath(),n},square:function(e){var n=Math.sqrt(a())/1.7;return e.moveTo(t[0]-n,t[1]-n),e.lineTo(t[0]+n,t[1]-n),e.lineTo(t[0]+n,t[1]+n),e.lineTo(t[0]-n,t[1]+n),e.closePath(),n},diamond:function(e){var n=Math.sqrt(a())/1.5;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0]+n,t[1]),e.lineTo(t[0],t[1]+n),e.lineTo(t[0]-n,t[1]),e.closePath(),n},triangle:function(e){var n=Math.sqrt(a())/Math.sqrt(3);return e.moveTo(t[0],t[1]-n),e.lineTo(t[0]+n,t[1]+n),e.lineTo(t[0]-n,t[1]+n),e.closePath(),n},ellipse:function(e){var n=Math.sqrt(a())/2;return e.save(),e.translate(t[0],t[1]),e.scale(1.6,.8),e.beginPath(),e.arc(0,0,n,0,2*Math.PI),e.closePath(),e.restore(),n},marker:function(e){var n=Math.sqrt(a())/2;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0],t[1]+n),e.moveTo(t[0]-n,t[1]),e.lineTo(t[0]+n,t[1]),e.closePath(),n},"cross-circle":function(e){var n=Math.sqrt(a()),r=n/2;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0],t[1]+n),e.moveTo(t[0]-n,t[1]),e.lineTo(t[0]+n,t[1]),e.stroke(),e.beginPath(),e.moveTo(t[0],t[1]),e.arc(t[0],t[1],r,0,2*Math.PI),e.closePath(),r},"stroke-circle":function(e){var n=Math.sqrt(a()),r=n/2;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0],t[1]+n),e.stroke(),e.beginPath(),e.moveTo(t[0],t[1]),e.arc(t[0],t[1],r,0,2*Math.PI),e.closePath(),r},crescent:function(e){var r=Math.sqrt(a())/2,s=n(),o=.5*(1-Math.cos(s)),i=1.6*Math.abs(o-.5)+.01,l=s>Math.PI,c=Math.abs(o)>.5?l:!l,p=e.fillStyle,d=o<.157?"#669":"#557";return e.save(),e.fillStyle=d,e.beginPath(),e.moveTo(t[0],t[1]),e.arc(t[0],t[1],r,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=p,e.beginPath(),e.moveTo(t[0],t[1]),e.arc(t[0],t[1],r,-Math.PI/2,Math.PI/2,l),e.scale(i,1),e.arc(t[0]/i,t[1],r,Math.PI/2,-Math.PI/2,c),e.closePath(),e.fill(),e.restore(),r}};return s.type=function(t){return arguments.length?(e=d3.functor(t),s):e},s.size=function(t){return arguments.length?(a=d3.functor(t),s):a},s.age=function(t){return arguments.length?(n=d3.functor(t),s):n},s.text=function(t){return arguments.length?(r=d3.functor(t),s):r},s.position=function(e){if(arguments.length)return t=e,s},s},p.Canvas=U;var X=function(t){return(Math.pow(Math.E,t)-Math.pow(Math.E,-t))/2},tt=function(t){return(Math.pow(Math.E,t)+Math.pow(Math.E,-t))/2},et=function(t){return Math.log(t+Math.sqrt(t*t+1))},at=function(t){return(t+3*Math.PI)%(2*Math.PI)-Math.PI},nt=function(t){return(t+2*Math.PI)%(2*Math.PI)},rt=function(t){var e=t[0],a=b-t[1],n=t[2];return{x:n*Math.sin(a)*Math.cos(e),y:n*Math.sin(a)*Math.sin(e),z:n*Math.cos(a)}};Math.PI,Math.PI,Math.PI;var st={"stars-show":["stars-limit","stars-colors","stars-style-fill","stars-designation","stars-propername","stars-size","stars-exponent"],"stars-designation":["stars-designationType","stars-designationLimit"],"stars-propername":["stars-propernameLimit","stars-propernameType"],"dsos-show":["dsos-limit","dsos-colors","dsos-style-fill","dsos-names","dsos-size","dsos-exponent"],"dsos-names":["dsos-namesType","dsos-nameLimit"],"mw-show":["mw-style-opacity","mw-style-fill"],"constellations-names":["constellations-namesType"],"planets-show":["planets-symbolType","planets-names"],"planets-names":["planets-namesType"]};function ot(t){var e,a=t.id;switch(a){case"stars-show":e=!mt(a).checked;for(var n=0;n<st[a].length;n++)it(st[a][n],e);case"stars-designation":for(e=!mt("stars-designation").checked||!mt("stars-show").checked,n=0;n<st["stars-designation"].length;n++)it(st["stars-designation"][n],e);case"stars-propername":for(e=!mt("stars-propername").checked||!mt("stars-show").checked,n=0;n<st["stars-propername"].length;n++)it(st["stars-propername"][n],e);break;case"dsos-show":for(e=!mt(a).checked,n=0;n<st[a].length;n++)it(st[a][n],e);case"dsos-names":for(e=!mt("dsos-names").checked||!mt("dsos-show").checked,n=0;n<st["dsos-names"].length;n++)it(st["dsos-names"][n],e);break;case"planets-show":for(e=!mt(a).checked,n=0;n<st[a].length;n++)it(st[a][n],e);case"planets-names":for(e=!mt("planets-names").checked||!mt("planets-show").checked,n=0;n<st["planets-names"].length;n++)it(st["planets-names"][n],e);break;case"constellations-names":case"mw-show":for(e=!mt(a).checked,n=0;n<st[a].length;n++)it(st[a][n],e)}}function it(t,e){var a=mt(t);a&&(a.disabled=e,a.style.color=e?"#999":"#000",a.previousSibling.style.color=e?"#999":"#000")}function lt(t,e){var a=function(t){var e=0,a=0;if(t.offsetParent)do{e+=t.offsetLeft,a+=t.offsetTop}while(null!==(t=t.offsetParent));return[e,a]}(t);d3.select("#error").html(e).style({top:V(a[1]+t.offsetHeight+1),left:V(a[0]),opacity:1}),t.focus()}function ct(t){var e,a="hr"===t.id||"min"===t.id||"sec"===t.id?1:0;if(t.validity){if((e=t.validity).typeMismatch||e.badInput)return lt(t,t.title+": check field value"),!1;if(e.rangeOverflow||e.rangeUnderflow)return lt(t,t.title+" must be between "+(parseInt(t.min)+a)+" and "+(parseInt(t.max)-a)),!1}else{if(!J(e=t.value))return lt(t,t.title+": check field value"),!1;if((e=parseFloat(e))<t.min||e>t.max)return lt(t,t.title+" must be between "+(t.min+a)+" and "+(+t.max-a)),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function pt(t){var e;if(t.validity){if((e=t.validity).typeMismatch||e.badInput)return lt(t,t.title+": check field value"),!1;if(-1===t.value.search(/^#[0-9A-F]{6}$/i))return lt(t,t.title+": not a color value"),!1}else{if(""===(e=t.value))return!0;if(-1===e.search(/^#[0-9A-F]{6}$/i))return lt(t,t.title+": not a color value"),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function dt(t,e){var a=mt("centerx");return a?(e&&("equatorial"===t&&"equatorial"!==e?(a.value=(a.value/15).toFixed(1),a.value<0&&(a.value+=24)):"equatorial"!==t&&"equatorial"===e&&(a.value=(15*a.value).toFixed(1),a.value>180&&(a.value-=360))),"equatorial"===t?(a.min="0",a.max="24",mt("cxunit").innerHTML="h"):(a.min="-180",a.max="180",mt("cxunit").innerHTML="\xb0"),a.value):null}function ut(t,e){var a=mt("centerx"),n=mt("centery"),r=mt("centerz");a&&n&&((null===t||t.length<1)&&(t=[0,0,0]),(t.length<=2||void 0===t[2])&&(t[2]=0),a.value="equatorial"!==e?t[0].toFixed(1):t[0]<0?(t[0]/15+24).toFixed(1):(t[0]/15).toFixed(1),n.value=t[1].toFixed(1),r.value=null!==t[2]?t[2].toFixed(1):0,E.set({center:t}))}function ft(t){var e=t?"inline-block":"none";d3.select(s+" ~ #celestial-form").selectAll(".advanced").style("display",e),d3.select(s+" ~ #celestial-form").selectAll("#label-propername").style("display",t?"none":"inline-block")}function ht(){var t,e,a=d3.select(s+" ~ #celestial-form").select("#constellation"),n=[],r=0,o=O;p.container.selectAll(".constname").each((function(a,s){(t=a.id)===o.constellation&&(r=s),(e=a.properties[o.constellations.namesType])!==t&&(e+=" ("+t+")"),n.push({o:t,n:e})})),n.length<1||a.length<1?setTimeout(ht,1e3):(n=[{o:"---",n:"(Select constellation)"}].concat(n),a.selectAll("option").remove(),a.selectAll("option").data(n).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),a.property("selectedIndex",r))}function mt(t){return document.querySelector(s+" ~ #celestial-form #"+t)}var yt={sol:.0002959122082855911,mer:0x95955473dbc3,ven:0x89d9374048629,ter:0xa923c08a47948,lun:36599199229256,mar:319711652803400,cer:467549107200,ves:129071530155,jup:0xd20883d548bcd80,sat:0x3ee3798098fbac0,ura:0x99ad2c4e2f7f70,nep:0xb54f848fd74430,plu:7327611364884,eri:827117568e4},gt={sol:"\u2609",mer:"\u263f",ven:"\u2640",ter:"\u2295",lun:"\u25cf",mar:"\u2642",cer:"\u26b3",ves:"\u26b6",jup:"\u2643",sat:"\u2644",ura:"\u2645",nep:"\u2646",plu:"\u2647",eri:"\u26aa"},vt=23.43928*w,Mt=Math.sin(vt),bt=Math.cos(vt),wt=["a","e","i","w","M","L","W","N","n","ep","ref","lecl","becl","Tilt"],kt=function(){var t,e,a,n=yt.sol,r="sol",s={},o={};function i(e){return l(e),"sol"===t?(o.ephemeris.x=0,o.ephemeris.y=0,o.ephemeris.z=0,o.ephemeris.mag=-6,i):(c(),i)}var l=function(t){var e,a=o.ephemeris={};t&&(e=t instanceof Date?new Date(t.valueOf()):Z(t)),e||(e=new Date),a.jd=u(e),(e=Z(s.ep))||(e=Z("2000-01-01")),a.jd0=u(e),a.d=a.jd-a.jd0,a.cy=a.d/36525},c=function(){var e,a=o.ephemeris;if("lun"===t){if(!(a=function(t){if("undefined"!==typeof xt)return xt.elements(t)}(a)))return}else{for(var r=0;r<wt.length;r++)Y(s,e=wt[r])&&(Y(s,"d"+e)?a[e]=s[e]+s["d"+e]*a.cy:Y(s,e)&&(a[e]=s[e]));Y(a,"M")&&!Y(a,"dM")&&Y(a,"n")&&(a.M+=a.n*a.d)}!function(){var t=o.ephemeris;t.hasOwnProperty("w")||(t.w=t.W-t.N);t.hasOwnProperty("M")||(t.M=t.L-t.W);t.e<1&&(t.M=at(t.M));t.P=M*Math.sqrt(Math.pow(t.a,3)/n)/365.25,t.T=t.jd0-t.M/b/t.P,1!==t.e?(t.q=t.a*(1-t.e),t.t0=t.a*Math.sqrt(Math.abs(t.a)/n)):(t.w0=3/Math.sqrt(2)/(t.q*Math.sqrt(t.q/n)),t.a=0,t.t0=0);t.am=Math.sqrt(n*t.q*(1+t.e))}(),function(){var t,e,a,n,r,s=o.ephemeris;1===s.e?(r=s.jd0-s.T,n=s.w0*r*.5,e=Math.pow(n+Math.sqrt(n*n+1),1/3),s.v=2*Math.atan(e-1/e)):(s.E=function(){var t,e,a,n,r=o.ephemeris,s=r.e,i=r.M,l=1e-8,c=0,d=1.9,u=!1,f=0;if(!i)return 0;if(s<1&&((i<-Math.PI||i>Math.PI)&&(c=i-(n=at(i)),i=n),s<.9)){t=Math.atan2(Math.sin(i),Math.cos(i)-s);do{t-=e=(t-s*Math.sin(t)-i)/(1-s*Math.cos(t))}while(Math.abs(e)>l);return t}i<0&&(i=-i,u=!0);t=i,(l*=Math.abs(1-s))<1e-15&&(l=1e-15);(s>.8&&i<Math.PI/3||s>1)&&((a=i/Math.abs(1-s))*a>6*Math.abs(1-s)&&(a=i<Math.PI?Math.pow(6*i,1/3):et(i/s)),t=a);s>1&&i>4&&(t=Math.log(i));if(s<1)for(;Math.abs(d)>l;)t+=d=-(e=f++>8?p(t,s)-i:t-s*Math.sin(t)-i)/(1-s*Math.cos(t));else for(;Math.abs(d)>l;)t+=d=-(e=f++>7?-p(t,s)-i:s*X(t)-t-i)/(s*tt(t)-1);return u?c-t:c+t}(),s.e>1?(t=s.e-tt(s.E),e=X(s.E)):(t=Math.cos(s.E)-s.e,e=Math.sin(s.E)),e*=Math.sqrt(Math.abs(1-s.e*s.e)),s.v=Math.atan2(e,t));a=s.q*(1+s.e),s.r=a/(1+s.e*Math.cos(s.v))}(),function(){var t=o.ephemeris,e=t.v+t.w;t.x=t.r*(Math.cos(t.N)*Math.cos(e)-Math.sin(t.N)*Math.sin(e)*Math.cos(t.i)),t.y=t.r*(Math.sin(t.N)*Math.cos(e)+Math.cos(t.N)*Math.sin(e)*Math.cos(t.i)),t.z=t.r*(Math.sin(e)*Math.sin(t.i))}()};function p(t,e){for(var a=e>1?t*t:-t*t,n=e*a*t/6,r=(1-e)*t-n,s=4;Math.abs(n)>1e-15;)r-=n*=a/(s*(s+1)),s+=2;return r}function d(){var t=o.ephemeris,e=Math.atan2(t.y,t.x),a=Math.atan2(t.z,Math.sqrt(t.x*t.x+t.y*t.y));return t.l=nt(e),t.b=a,o}function u(t){var e=t.getUTCFullYear(),a=t.getUTCMonth()+1,n=t.getUTCDate(),r=(t.getUTCHours()-12+t.getUTCMinutes()/60+t.getUTCSeconds()/3600)/24;if(e<-4799)return-1;var s=Math.floor((14-a)/12),o=e+4800-s,i=a+12*s-3;return n+Math.floor((153*i+2)/5)+365*o+Math.floor(o/4)-Math.floor(o/100)+Math.floor(o/400)-32045+r}return i.cartesian=function(){return o},i.spherical=function(){return d(),o},i.equatorial=function(e){return function(e){var a=o.ephemeris,n=e.ephemeris;vt=(23.439292-.0130042*a.cy-1.667e-7*a.cy*a.cy+5.028e-7*a.cy*a.cy*a.cy)*w,Mt=Math.sin(vt),bt=Math.cos(vt);var r="lun"===t?{x:0,y:0,z:0}:{x:n.x,y:n.y,z:n.z};a.xeq=a.x-r.x,a.yeq=(a.y-r.y)*bt-(a.z-r.z)*Mt,a.zeq=(a.y-r.y)*Mt+(a.z-r.z)*bt,a.ra=nt(Math.atan2(a.yeq,a.xeq)),a.dec=Math.atan2(a.zeq,Math.sqrt(a.xeq*a.xeq+a.yeq*a.yeq)),"lun"===t&&(a=function(t,e){if(d(),"undefined"!==typeof xt)return xt.corr(t,e)}(a,n));a.pos=[a.ra/w,a.dec/w],a.rt=Math.sqrt(a.xeq*a.xeq+a.yeq*a.yeq+a.zeq*a.zeq),"sol"!==t&&(a.mag=function(){var t=o.ephemeris,e=t.r,a=t.rt,n=Math.acos((e*e+a*a-1)/(2*e*a)),r=.666*((1-n/Math.PI)*Math.cos(n)+1/Math.PI*Math.sin(n));return 1*o.H+5*Math.log(e*a)*Math.LOG10E-2.5*Math.log(r)*Math.LOG10E}())}(e),o},i.transpose=function(){return function(){var t=o.ephemeris;if(!t.ref||"ecl"===t.ref)return t.tx=t.x,t.ty=t.y,void(t.tz=t.z);t.lecl,Math.PI,t.becl;var e=rt([t.tl,t.tb,t.r]);t.tx=e.x,t.ty=e.y,t.tz=e.z}(),o},i.elements=function(t){var e;if(!arguments.length||void 0===arguments[0])return i;for(var a=0;a<wt.length;a++)Y(t,e=wt[a])&&(s[e]=t[e],"a"===e||"e"===e?s[e]*=1:"ref"!==e&&"ep"!==e&&(s[e]*=w),Y(t,"d"+e)&&(s[e="d"+e]=t[e],s[e]*="da"===e||"de"===e?1:w));return i},i.params=function(t){if(!arguments.length)return i;for(var e in t)Y(t,e)&&"elements"!==t[e]&&(o[e]=t[e]);return i},i.parentBody=function(t){return arguments.length?(n=yt[r=t],i):r},i.id=function(e){return arguments.length?(t=e,a=gt[e],i):t},i.Name=function(t){return arguments.length?(e=t,i):e},i.symbol=function(t){return arguments.length?(a=gt[t],i):a},i},xt={elements:function(t){var e=(t.jd-2451545)/36525,a=e*e,n=e*a,r=e*n,s=1e-4*a,o=1e-6*n,i=1e-8*r,l=383397.6+(3400.4*Math.cos(w*(235.7004+890534.223*e-32.601*s+3.664*o-1.769*i))-635.6*Math.cos(w*(100.737+413335.3554*e-122.571*s-10.684*o+5.028*i))-235.6*Math.cos(w*(134.9634+477198.8676*e+89.97*s+14.348*o-6.797*i))+218.1*Math.cos(w*(238.1713+854535.1727*e-31.065*s+3.623*o-1.769*i))+181*Math.cos(w*(10.6638+1367733.0907*e+57.37*s+18.011*o-8.566*i))-39.9*Math.cos(w*(103.2079+377336.3051*e-121.035*s-10.724*o+5.028*i))-38.4*Math.cos(w*(233.2295+926533.2733*e-34.136*s+3.705*o-1.769*i))+33.8*Math.cos(w*(336.4374+1303869.5784*e-155.171*s-7.02*o+3.259*i))+28.8*Math.cos(w*(111.4008+1781068.4461*e-65.201*s+7.328*o-3.538*i))+12.6*Math.cos(w*(13.1347+1331734.0404*e+58.906*s+17.971*o-8.566*i))+11.4*Math.cos(w*(186.5442+966404.0351*e-68.058*s-.567*o+.232*i))-11.1*Math.cos(w*(222.5657-441199.8173*e-91.506*s-14.307*o+6.797*i))-10.2*Math.cos(w*(269.9268+954397.7353*e+179.941*s+28.695*o-13.594*i))+9.7*Math.cos(w*(145.6272+1844931.9583*e+147.34*s+32.359*o-15.363*i))+9.6*Math.cos(w*(240.6422+818536.1225*e-29.529*s+3.582*o-1.769*i))+8*Math.cos(w*(297.8502+445267.1115*e-16.3*s+1.832*o-.884*i))-6.2*Math.cos(w*(132.4925+513197.9179*e+88.434*s+14.388*o-6.797*i))+6*Math.cos(w*(173.5506+1335801.3346*e-48.901*s+5.496*o-2.653*i))+3.7*Math.cos(w*(113.8717+1745069.3958*e-63.665*s+7.287*o-3.538*i))+3.6*Math.cos(w*(338.9083+1267870.5281*e-153.636*s-7.061*o+3.259*i))+3.2*Math.cos(w*(246.3642+2258267.3137*e+24.769*s+21.675*o-10.335*i))-3*Math.cos(w*(8.1929+1403732.141*e+55.834*s+18.052*o-8.566*i))+2.3*Math.cos(w*(98.2661+449334.4057*e-124.107*s-10.643*o+5.028*i))-2.2*Math.cos(w*(357.5291+35999.0503*e-1.536*s+.041*o+0*i))-2*Math.cos(w*(38.5872+858602.4669*e-138.871*s-8.852*o+4.144*i))-1.8*Math.cos(w*(105.6788+341337.2548*e-119.499*s-10.765*o+5.028*i))-1.7*Math.cos(w*(201.474+826670.7108*e-245.142*s-21.367*o+10.057*i))+1.6*Math.cos(w*(184.1196+401329.0556*e+125.428*s+18.579*o-8.798*i))-1.4*Math.cos(w*(308.4192-489205.1674*e+158.029*s+14.915*o-7.029*i))+1.3*Math.cos(w*(325.7736-63863.5122*e-212.541*s-25.031*o+11.826*i)))+(-.55*Math.cos(w*(238.2+854535.2*e))+.1*Math.cos(w*(103.2+377336.3*e))+.1*Math.cos(w*(233.2+926533.3*e)))*e,c=.055544+(.014217*Math.cos(w*(100.737+413335.3554*e-122.571*s-10.684*o+5.028*i))+.008551*Math.cos(w*(325.7736-63863.5122*e-212.541*s-25.031*o+11.826*i))-.001383*Math.cos(w*(134.9634+477198.8676*e+89.97*s+14.348*o-6.797*i))+.001353*Math.cos(w*(10.6638+1367733.0907*e+57.37*s+18.011*o-8.566*i))-.001146*Math.cos(w*(66.5106+349471.8432*e-335.112*s-35.715*o+16.854*i))-915e-6*Math.cos(w*(201.474+826670.7108*e-245.142*s-21.367*o+10.057*i))+869e-6*Math.cos(w*(103.2079+377336.3051*e-121.035*s-10.724*o+5.028*i))-628e-6*Math.cos(w*(235.7004+890534.223*e-32.601*s+3.664*o-1.769*i))-393e-6*Math.cos(w*(291.5472-127727.0245*e-425.082*s-50.062*o+23.651*i))+284e-6*Math.cos(w*(328.2445-99862.5625*e-211.005*s-25.072*o+11.826*i))-278e-6*Math.cos(w*(162.8868-31931.7561*e-106.271*s-12.516*o+5.913*i))-24e-5*Math.cos(w*(269.9268+954397.7353*e+179.941*s+28.695*o-13.594*i))+23e-5*Math.cos(w*(111.4008+1781068.4461*e-65.201*s+7.328*o-3.538*i))+229e-6*Math.cos(w*(167.2476+762807.1986*e-457.683*s-46.398*o+21.882*i))-202e-6*Math.cos(w*(83.3826-12006.2998*e+247.999*s+29.262*o-13.826*i))+19e-5*Math.cos(w*(190.8102-541062.3799*e-302.511*s-39.379*o+18.623*i))+177e-6*Math.cos(w*(357.5291+35999.0503*e-1.536*s+.041*o+0*i))+153e-6*Math.cos(w*(32.2842+285608.3309*e-547.653*s-60.746*o+28.679*i))-137e-6*Math.cos(w*(44.8902+1431596.6029*e+269.911*s+43.043*o-20.392*i))+122e-6*Math.cos(w*(145.6272+1844931.9583*e+147.34*s+32.359*o-15.363*i))+116e-6*Math.cos(w*(302.211+1240006.0662*e-367.713*s-32.051*o+15.085*i))-111e-6*Math.cos(w*(203.9449+790671.6605*e-243.606*s-21.408*o+10.057*i))-108e-6*Math.cos(w*(68.9815+313472.7929*e-333.576*s-35.756*o+16.854*i))+96e-6*Math.cos(w*(336.4374+1303869.5784*e-155.171*s-7.02*o+3.259*i))-9e-5*Math.cos(w*(98.2661+449334.4057*e-124.107*s-10.643*o+5.028*i))+9e-5*Math.cos(w*(13.1347+1331734.0404*e+58.906*s+17.971*o-8.566*i))+56e-6*Math.cos(w*(55.8468-1018261.2475*e-392.482*s-53.726*o+25.42*i))-56e-6*Math.cos(w*(238.1713+854535.1727*e-31.065*s+3.623*o-1.769*i))+52e-6*Math.cos(w*(308.4192-489205.1674*e+158.029*s+14.915*o-7.029*i))-5e-5*Math.cos(w*(133.0212+698943.6863*e-670.224*s-71.429*o+33.708*i))-49e-6*Math.cos(w*(267.9846+1176142.554*e-580.254*s-57.082*o+26.911*i))-49e-6*Math.cos(w*(184.1196+401329.0556*e+125.428*s+18.579*o-8.798*i))-45e-6*Math.cos(w*(49.1562-75869.812*e+35.458*s+4.231*o-2.001*i))+44e-6*Math.cos(w*(257.3208-191590.5367*e-637.623*s-75.093*o+35.477*i))+42e-6*Math.cos(w*(105.6788+341337.2548*e-119.499*s-10.765*o+5.028*i))+42e-6*Math.cos(w*(160.4159+4067.2942*e-107.806*s-12.475*o+5.913*i))+4e-5*Math.cos(w*(246.3642+2258267.3137*e+24.769*s+21.675*o-10.335*i))-4e-5*Math.cos(w*(156.5838-604925.8921*e-515.053*s-64.41*o+30.448*i))+36e-6*Math.cos(w*(169.7185+726808.1483*e-456.147*s-46.439*o+21.882*i))+29e-6*Math.cos(w*(113.8717+1745069.3958*e-63.665*s+7.287*o-3.538*i))-29e-6*Math.cos(w*(297.8502+445267.1115*e-16.3*s+1.832*o-.884*i))-28e-6*Math.cos(w*(294.0181-163726.0747*e-423.546*s-50.103*o+23.651*i))+27e-6*Math.cos(w*(263.6238+381403.5993*e-228.841*s-23.199*o+10.941*i))-26e-6*Math.cos(w*(358.0578+221744.8187*e-760.194*s-85.777*o+40.505*i))-26e-6*Math.cos(w*(8.1929+1403732.141*e+55.834*s+18.052*o-8.566*i)))+.001*e*(-.0022*Math.cos(w*(103.2+377336.3*e))),p=.0449858+(.0011776*Math.cos(w*(49.1562-75869.812*e+35.458*s+4.231*o-2.001*i))-971e-7*Math.cos(w*(235.7004+890534.223*e-32.601*s+3.664*o-1.769*i))+908e-7*Math.cos(w*(186.5442+966404.0351*e-68.058*s-.567*o+.232*i))+623e-7*Math.cos(w*(83.3826-12006.2998*e+247.999*s+29.262*o-13.826*i))+483e-7*Math.cos(w*(51.6271-111868.8623*e+36.994*s+4.19*o-2.001*i))+348e-7*Math.cos(w*(100.737+413335.3554*e-122.571*s-10.684*o+5.028*i))-316e-7*Math.cos(w*(308.4192-489205.1674*e+158.029*s+14.915*o-7.029*i))-253e-7*Math.cos(w*(46.6853-39870.7617*e+33.922*s+4.272*o-2.001*i))-141e-7*Math.cos(w*(274.1928-553068.6797*e-54.513*s-10.116*o+4.797*i))+127e-7*Math.cos(w*(325.7736-63863.5122*e-212.541*s-25.031*o+11.826*i))+117e-7*Math.cos(w*(184.1196+401329.0556*e+125.428*s+18.579*o-8.798*i))-78e-7*Math.cos(w*(98.3124-151739.624*e+70.916*s+8.462*o-4.001*i))-63e-7*Math.cos(w*(238.1713+854535.1727*e-31.065*s+3.623*o-1.769*i))+63e-7*Math.cos(w*(134.9634+477198.8676*e+89.97*s+14.348*o-6.797*i))+36e-7*Math.cos(w*(321.5076+1443602.9027*e+21.912*s+13.78*o-6.566*i))-35e-7*Math.cos(w*(10.6638+1367733.0907*e+57.37*s+18.011*o-8.566*i))+24e-7*Math.cos(w*(149.8932+337465.5434*e-87.113*s-6.453*o+3.028*i))+24e-7*Math.cos(w*(170.9849-930404.9848*e+66.523*s+.608*o-.232*i)))+.001*(-.0203*Math.cos(w*(125-1934.1*e))+.0034*Math.cos(w*(220.2-1935.5*e))),d=83.353+4069.0137*e-103.238*s-12.492*o+5.263*i+(-15.448*Math.sin(w*(100.737+413335.3554*e-122.571*s-10.684*o+5.028*i))-9.642*Math.sin(w*(325.7736-63863.5122*e-212.541*s-25.031*o+11.826*i))-2.721*Math.sin(w*(134.9634+477198.8676*e+89.97*s+14.348*o-6.797*i))+2.607*Math.sin(w*(66.5106+349471.8432*e-335.112*s-35.715*o+16.854*i))+2.085*Math.sin(w*(201.474+826670.7108*e-245.142*s-21.367*o+10.057*i))+1.477*Math.sin(w*(10.6638+1367733.0907*e+57.37*s+18.011*o-8.566*i))+.968*Math.sin(w*(291.5472-127727.0245*e-425.082*s-50.062*o+23.651*i))-.949*Math.sin(w*(103.2079+377336.3051*e-121.035*s-10.724*o+5.028*i))-.703*Math.sin(w*(167.2476+762807.1986*e-457.683*s-46.398*o+21.882*i))-.66*Math.sin(w*(235.7004+890534.223*e-32.601*s+3.664*o-1.769*i))-.577*Math.sin(w*(190.8102-541062.3799*e-302.511*s-39.379*o+18.623*i))-.524*Math.sin(w*(269.9268+954397.7353*e+179.941*s+28.695*o-13.594*i))-.482*Math.sin(w*(32.2842+285608.3309*e-547.653*s-60.746*o+28.679*i))+.452*Math.sin(w*(357.5291+35999.0503*e-1.536*s+.041*o+0*i))-.381*Math.sin(w*(302.211+1240006.0662*e-367.713*s-32.051*o+15.085*i))-.342*Math.sin(w*(328.2445-99862.5625*e-211.005*s-25.072*o+11.826*i))-.312*Math.sin(w*(44.8902+1431596.6029*e+269.911*s+43.043*o-20.392*i))+.282*Math.sin(w*(162.8868-31931.7561*e-106.271*s-12.516*o+5.913*i))+.255*Math.sin(w*(203.9449+790671.6605*e-243.606*s-21.408*o+10.057*i))+.252*Math.sin(w*(68.9815+313472.7929*e-333.576*s-35.756*o+16.854*i))-.211*Math.sin(w*(83.3826-12006.2998*e+247.999*s+29.262*o-13.826*i))+.193*Math.sin(w*(267.9846+1176142.554*e-580.254*s-57.082*o+26.911*i))+.191*Math.sin(w*(133.0212+698943.6863*e-670.224*s-71.429*o+33.708*i))-.184*Math.sin(w*(55.8468-1018261.2475*e-392.482*s-53.726*o+25.42*i))+.182*Math.sin(w*(145.6272+1844931.9583*e+147.34*s+32.359*o-15.363*i))-.158*Math.sin(w*(257.3208-191590.5367*e-637.623*s-75.093*o+35.477*i))+.148*Math.sin(w*(156.5838-604925.8921*e-515.053*s-64.41*o+30.448*i))-.111*Math.sin(w*(169.7185+726808.1483*e-456.147*s-46.439*o+21.882*i))+.101*Math.sin(w*(13.1347+1331734.0404*e+58.906*s+17.971*o-8.566*i))+.1*Math.sin(w*(358.0578+221744.8187*e-760.194*s-85.777*o+40.505*i))+.087*Math.sin(w*(98.2661+449334.4057*e-124.107*s-10.643*o+5.028*i))+.08*Math.sin(w*(42.948+1653341.4216*e-490.283*s-42.734*o+20.113*i))+.08*Math.sin(w*(222.5657-441199.8173*e-91.506*s-14.307*o+6.797*i))+.077*Math.sin(w*(294.0181-163726.0747*e-423.546*s-50.103*o+23.651*i))-.073*Math.sin(w*(280.8834-1495460.1151*e-482.452*s-68.074*o+32.217*i))-.071*Math.sin(w*(304.6819+1204007.0159*e-366.177*s-32.092*o+15.085*i))-.069*Math.sin(w*(233.7582+1112279.0417*e-792.795*s-82.113*o+38.736*i))-.067*Math.sin(w*(34.7551+249609.2807*e-546.117*s-60.787*o+28.679*i))-.067*Math.sin(w*(263.6238+381403.5993*e-228.841*s-23.199*o+10.941*i))+.055*Math.sin(w*(21.6203-1082124.7597*e-605.023*s-78.757*o+37.246*i))+.055*Math.sin(w*(308.4192-489205.1674*e+158.029*s+14.915*o-7.029*i))-.054*Math.sin(w*(8.7216+1589477.9094*e-702.824*s-67.766*o+31.939*i))-.052*Math.sin(w*(179.8536+1908795.4705*e+359.881*s+57.39*o-27.189*i))-.05*Math.sin(w*(98.7948+635080.1741*e-882.765*s-96.461*o+45.533*i))-.049*Math.sin(w*(128.6604-95795.2683*e-318.812*s-37.547*o+17.738*i))-.047*Math.sin(w*(17.3544+425341.6552*e-370.57*s-39.946*o+18.854*i))-.044*Math.sin(w*(160.4159+4067.2942*e-107.806*s-12.475*o+5.913*i))-.043*Math.sin(w*(238.1713+854535.1727*e-31.065*s+3.623*o-1.769*i))+.042*Math.sin(w*(270.4555+1140143.5037*e-578.718*s-57.123*o+26.911*i))-.042*Math.sin(w*(132.4925+513197.9179*e+88.434*s+14.388*o-6.797*i))-.041*Math.sin(w*(122.3573-668789.4043*e-727.594*s-89.441*o+42.274*i))-.04*Math.sin(w*(105.6788+341337.2548*e-119.499*s-10.765*o+5.028*i))+.038*Math.sin(w*(135.4921+662944.6361*e-668.688*s-71.47*o+33.708*i))-.037*Math.sin(w*(242.391-51857.2124*e-460.54*s-54.293*o+25.652*i))+.036*Math.sin(w*(336.4374+1303869.5784*e-155.171*s-7.02*o+3.259*i))+.035*Math.sin(w*(223.0943-255454.0489*e-850.164*s-100.124*o+47.302*i))-.034*Math.sin(w*(193.2811-577061.4302*e-300.976*s-39.419*o+18.623*i))+.031*Math.sin(w*(87.6023-918398.685*e-181.476*s-28.654*o+13.594*i)))+.001*e*(2.4*Math.sin(w*(103.2+377336.3*e))),u=125.0446-1934.13618*e+20.762*s+2.139*o-1.65*i+(-1.4979*Math.sin(w*(49.1562-75869.812*e+35.458*s+4.231*o-2.001*i))-.15*Math.sin(w*(357.5291+35999.0503*e-1.536*s+.041*o+0*i))-.1226*Math.sin(w*(235.7004+890534.223*e-32.601*s+3.664*o-1.769*i))+.1176*Math.sin(w*(186.5442+966404.0351*e-68.058*s-.567*o+.232*i))-.0801*Math.sin(w*(83.3826-12006.2998*e+247.999*s+29.262*o-13.826*i))-.0616*Math.sin(w*(51.6271-111868.8623*e+36.994*s+4.19*o-2.001*i))+.049*Math.sin(w*(100.737+413335.3554*e-122.571*s-10.684*o+5.028*i))+.0409*Math.sin(w*(308.4192-489205.1674*e+158.029*s+14.915*o-7.029*i))+.0327*Math.sin(w*(134.9634+477198.8676*e+89.97*s+14.348*o-6.797*i))+.0324*Math.sin(w*(46.6853-39870.7617*e+33.922*s+4.272*o-2.001*i))+.0196*Math.sin(w*(98.3124-151739.624*e+70.916*s+8.462*o-4.001*i))+.018*Math.sin(w*(274.1928-553068.6797*e-54.513*s-10.116*o+4.797*i))+.015*Math.sin(w*(325.7736-63863.5122*e-212.541*s-25.031*o+11.826*i))-.015*Math.sin(w*(184.1196+401329.0556*e+125.428*s+18.579*o-8.798*i))-.0078*Math.sin(w*(238.1713+854535.1727*e-31.065*s+3.623*o-1.769*i))-.0045*Math.sin(w*(10.6638+1367733.0907*e+57.37*s+18.011*o-8.566*i))+.0044*Math.sin(w*(321.5076+1443602.9027*e+21.912*s+13.78*o-6.566*i))-.0042*Math.sin(w*(162.8868-31931.7561*e-106.271*s-12.516*o+5.913*i))-.0031*Math.sin(w*(170.9849-930404.9848*e+66.523*s+.608*o-.232*i))+.0031*Math.sin(w*(103.2079+377336.3051*e-121.035*s-10.724*o+5.028*i))+.0029*Math.sin(w*(222.612-1042273.8471*e+103.516*s+4.798*o-2.232*i))+.0028*Math.sin(w*(184.0733+1002403.0853*e-69.594*s-.526*o+.232*i)))+.001*(25.9*Math.sin(w*(125-1934.1*e))-4.3*Math.sin(w*(220.2-1935.5*e))+.38*Math.sin(w*(357.5+35999.1*e))*e),f=218.31665+481267.88134*e-13.268*s+1.856*o-1.534*i+(-.92581*Math.sin(w*(235.7004+890534.223*e-32.601*s+3.664*o-1.769*i))+.33262*Math.sin(w*(100.737+413335.3554*e-122.571*s-10.684*o+5.028*i))-.18402*Math.sin(w*(357.5291+35999.0503*e-1.536*s+.041*o+0*i))+.11007*Math.sin(w*(134.9634+477198.8676*e+89.97*s+14.348*o-6.797*i))-.06055*Math.sin(w*(238.1713+854535.1727*e-31.065*s+3.623*o-1.769*i))+.04741*Math.sin(w*(325.7736-63863.5122*e-212.541*s-25.031*o+11.826*i))-.03086*Math.sin(w*(10.6638+1367733.0907*e+57.37*s+18.011*o-8.566*i))+.02184*Math.sin(w*(103.2079+377336.3051*e-121.035*s-10.724*o+5.028*i))+.01645*Math.sin(w*(49.1562-75869.812*e+35.458*s+4.231*o-2.001*i))+.01022*Math.sin(w*(233.2295+926533.2733*e-34.136*s+3.705*o-1.769*i))-.00756*Math.sin(w*(336.4374+1303869.5784*e-155.171*s-7.02*o+3.259*i))-.0053*Math.sin(w*(222.5657-441199.8173*e-91.506*s-14.307*o+6.797*i))-.00496*Math.sin(w*(162.8868-31931.7561*e-106.271*s-12.516*o+5.913*i))-.00472*Math.sin(w*(297.8502+445267.1115*e-16.3*s+1.832*o-.884*i))-.00271*Math.sin(w*(240.6422+818536.1225*e-29.529*s+3.582*o-1.769*i))+.00264*Math.sin(w*(132.4925+513197.9179*e+88.434*s+14.388*o-6.797*i))-.00254*Math.sin(w*(186.5442+966404.0351*e-68.058*s-.567*o+.232*i))+.00234*Math.sin(w*(269.9268+954397.7353*e+179.941*s+28.695*o-13.594*i))-.0022*Math.sin(w*(13.1347+1331734.0404*e+58.906*s+17.971*o-8.566*i))-.00202*Math.sin(w*(355.0582+71998.1006*e-3.072*s+.082*o+0*i))+.00167*Math.sin(w*(328.2445-99862.5625*e-211.005*s-25.072*o+11.826*i))-.00143*Math.sin(w*(173.5506+1335801.3346*e-48.901*s+5.496*o-2.653*i))-.00121*Math.sin(w*(98.2661+449334.4057*e-124.107*s-10.643*o+5.028*i))-.00116*Math.sin(w*(145.6272+1844931.9583*e+147.34*s+32.359*o-15.363*i))+.00102*Math.sin(w*(105.6788+341337.2548*e-119.499*s-10.765*o+5.028*i))-9e-4*Math.sin(w*(184.1196+401329.0556*e+125.428*s+18.579*o-8.798*i))-86e-5*Math.sin(w*(338.9083+1267870.5281*e-153.636*s-7.061*o+3.259*i))-78e-5*Math.sin(w*(111.4008+1781068.4461*e-65.201*s+7.328*o-3.538*i))+69e-5*Math.sin(w*(323.3027-27864.4619*e-214.077*s-24.99*o+11.826*i))+66e-5*Math.sin(w*(51.6271-111868.8623*e+36.994*s+4.19*o-2.001*i))+65e-5*Math.sin(w*(38.5872+858602.4669*e-138.871*s-8.852*o+4.144*i))-6e-4*Math.sin(w*(83.3826-12006.2998*e+247.999*s+29.262*o-13.826*i))+54e-5*Math.sin(w*(201.474+826670.7108*e-245.142*s-21.367*o+10.057*i))-52e-5*Math.sin(w*(308.4192-489205.1674*e+158.029*s+14.915*o-7.029*i))+48e-5*Math.sin(w*(8.1929+1403732.141*e+55.834*s+18.052*o-8.566*i))-41e-5*Math.sin(w*(46.6853-39870.7617*e+33.922*s+4.272*o-2.001*i))-33e-5*Math.sin(w*(274.1928-553068.6797*e-54.513*s-10.116*o+4.797*i))+3e-4*Math.sin(w*(160.4159+4067.2942*e-107.806*s-12.475*o+5.913*i)))+.001*(3.96*Math.sin(w*(119.7+131.8*e))+1.96*Math.sin(w*(125-1934.1*e))+(.463*Math.sin(w*(357.5+35999.1*e))+.152*Math.sin(w*(238.2+854535.2*e))-.071*Math.sin(w*(27.8+131.8*e))-.055*Math.sin(w*(103.2+377336.3*e))-.026*Math.sin(w*(233.2+926533.3*e)))*e+(14*Math.sin(w*(357.5+35999.1*e))+5*Math.sin(w*(238.2+854535.2*e)))*s);return t.a=l,t.e=c,t.i=2*Math.asin(p),t.w=nt(w*(d-u)),t.N=nt(w*u),t.M=nt(w*(f-d)),t},corr:function(t,e){var a=nt(e.M+Math.PI),n=nt(e.w+Math.PI),r=t.M+t.w,s=r+t.N-a-n,o=-.022234*Math.sin(t.M-2*s)+.011494*Math.sin(2*s)+-.003246*Math.sin(a)+-.001029*Math.sin(2*t.M-2*s)+-994838e-9*Math.sin(t.M-2*s+a)+925025e-9*Math.sin(t.M+2*s)+802851e-9*Math.sin(2*s-a)+715585e-9*Math.sin(t.M-a)+-610865e-9*Math.sin(s)+-541052e-9*Math.sin(t.M+a)+-261799e-9*Math.sin(2*r-2*s)+191986e-9*Math.sin(t.M-4*s);t.ra+=o;var i=-.003019*Math.sin(r-2*s)+-959931e-9*Math.sin(t.M-r-2*s)+-802851e-9*Math.sin(t.M+r-2*s)+575958e-9*Math.sin(r+2*s)+296706e-9*Math.sin(2*t.M+r);return t.dec+=i,t.age=nt(t.l-e.l+Math.PI),t.phase=.5*(1-Math.cos(t.age)),t}};function St(t){d3.select("body").append("div").attr("id","d3-celestial-svg").attr("style","display: none");var e,a,n=d3.select("#d3-celestial-svg").append("svg"),r=p.metrics(),s=E.set(),o=s.datapath,i=H[s.projection],l=x(s.center),c=[-l[0],-l[1]],d=i.scale*r.width/1024,u=p.projection(s.projection).rotate(l).translate([r.width/2,r.height/2]).scale([r.scale]),m=s.adaptable?Math.sqrt(r.scale/d):1,y=""!==s.culture&&"iau"!==s.culture?s.culture:"";n.selectAll("*").remove();var g=n.append("defs");i.clip&&u.clipAngle(90),e=d3.geo.circle().angle([179.95]).origin(c),n.attr("width",r.width).attr("height",r.height);for(var M=["background","milkyWay","milkyWayBg","gridLines","constBoundaries","planesequatorial","planesecliptic","planesgalactic","planessupergalactic","constLines","mapBorder","stars","dsos","planets","gridvaluesLon","gridvaluesLat","constNames","starDesignations","starNames","dsoNames","planetNames","horizon","daylight"],w={},z={},T=0;T<M.length;T++)w[M[T]]=n.append("g").attr({id:M[T],":inkscape:groupmode":"layer",":inkscape:label":M[T]}),z[M[T]]={};var j=d3.geo.graticule().minorStep([15,10]),L=d3.geo.path().projection(u),D=d3.queue(2);if(w.background.append("path").datum(e).attr("class","background").attr("d",L),z.background.fill=s.background.fill,s.lines.graticule.show){if("equatorial"===s.transform?(w.gridLines.append("path").datum(j).attr("class","gridLines").attr("d",L),z.gridLines=W(s.lines.graticule)):(p.graticule(w.gridLines,L,s.transform),z.gridLines=W(s.lines.graticule)),Y(s.lines.graticule,"lon")&&s.lines.graticule.lon.pos.length>0){var F={type:"FeatureCollection",features:q("lon",s.lines.graticule.lon.pos)};w.gridvaluesLon.selectAll(".gridvalues_lon").data(F.features).enter().append("text").attr("transform",(function(t,e){return G(t.geometry.coordinates)})).text((function(t){return t.properties.value})).attr({dy:".5em",dx:"-.75em",class:"gridvaluesLon"}),z.gridvaluesLon=V(s.lines.graticule.lon)}if(Y(s.lines.graticule,"lat")&&s.lines.graticule.lat.pos.length>0){var _={type:"FeatureCollection",features:q("lat",s.lines.graticule.lat.pos)};w.gridvaluesLat.selectAll(".gridvalues_lat").data(_.features).enter().append("text").attr("transform",(function(t,e){return G(t.geometry.coordinates)})).text((function(t){return t.properties.value})).attr({dy:"-.5em",dx:"-.75em",class:"gridvaluesLat"}),z.gridvaluesLat=V(s.lines.graticule.lat)}}for(var O in s.lines)Y(s.lines,O)&&"graticule"!=O&&!1!==s.lines[O].show&&(w[a="planes"+O].append("path").datum(d3.geo.circle().angle([90]).origin(v[O])).attr("class",a).attr("d",L),z[a]=W(s.lines[O]));function N(t){return i.clip&&d3.geo.distance(c,t)>b?0:1}function G(t){return"translate("+u(t)+")"}function U(t,e,a){return t+(e=e?"."+e:"")+(Y(B[t],y)?"."+y:"")+(a=a?"."+a:".json")}function W(t){var e={};return e.fill=t.fill||"none",e["fill-opacity"]=null!==t.opacity?t.opacity:1,e.stroke=t.stroke||"none",e["stroke-width"]=null!==t.width?t.width:0,e["stroke-opacity"]=null!==t.opacity?t.opacity:1,Y(t,"dash")?e["stroke-dasharray"]=t.dash.join(" "):e["stroke-dasharray"]="none",e.font=t.font||null,e}function V(t){var e={stroke:"none"};return e.fill=t.fill||"none",e["fill-opacity"]=null!==t.opacity?t.opacity:1,e["text-anchor"]=J(t.align),e.font=t.font||null,e}function $(t,e){return.9*(1-(Math.pow(Math.E,t*e)-1)/(Math.pow(Math.E,e)-1))}function J(t){return t?"center"===t?"middle":"right"===t?"end":"start":"start"}function K(t){var e={type:"Feature",id:t.id,properties:{},geometry:{}};return e.properties.name=t[s.planets.namesType],"symbol"!==s.planets.symbolType&&"letter"!==s.planets.symbolType||(e.properties.symbol=s.planets.symbols[e.id][s.planets.symbolType]),e.properties.mag=t.ephemeris.mag||10,"lun"===e.id&&(e.properties.age=t.ephemeris.age,e.properties.phase=t.ephemeris.phase),e.geometry.type="Point",e.geometry.coordinates=t.ephemeris.pos,e}function Q(t){var e=" {";for(var a in t)Y(t,a)&&(e+=a+":"+t[a]+"; ");return e+"} "}s.mw.show&&D.defer((function(t){d3.json(o+"mw.json",(function(e,a){e&&t(e);var n=P(a,s.transform),r=I(n);w.milkyWay.selectAll(".mway").data(n.features).enter().append("path").attr("class","milkyWay").attr("d",L),z.milkyWay=W(s.mw.style),(!Y(s.background,"opacity")||s.background.opacity>.95)&&(w.milkyWayBg.selectAll(".mwaybg").data(r.features).enter().append("path").attr("class","milkyWayBg").attr("d",L),z.milkyWayBg={fill:s.background.fill,"fill-opacity":s.background.opacity}),t(null)}))})),s.constellations.bounds&&D.defer((function(t){d3.json(o+U("constellations","borders"),(function(e,a){e&&t(e);var n=P(a,s.transform);if(p.constellation)var r=new RegExp("\\b"+p.constellation+"\\b");w.constBoundaries.selectAll(".bounds").data(n.features).enter().append("path").attr("class",(function(t){return p.constellation&&-1!==t.ids.search(r)?"constBoundariesSel":"constBoundaries"})).attr("d",L),z.constBoundaries=W(s.constellations.boundStyle),z.constBoundariesSel={fill:"none",stroke:s.constellations.boundStyle.stroke,"stroke-width":1.5*s.constellations.boundStyle.width,"stroke-opacity":1,"stroke-dasharray":"none"},t(null)}))})),s.constellations.lines&&D.defer((function(t){d3.json(o+U("constellations","lines"),(function(e,a){e&&t(e);var n=P(a,s.transform);w.constLines.selectAll(".lines").data(n.features).enter().append("path").attr("class",(function(t){return"constLines"+t.properties.rank})).attr("d",L);var r=Y(s.constellations.lineStyle,"dash")?s.constellations.lineStyle.dash.join(" "):"none";z.constLines1={fill:"none",stroke:s.constellations.lineStyle.stroke[0],"stroke-width":s.constellations.lineStyle.width[0],"stroke-opacity":s.constellations.lineStyle.opacity[0],"stroke-dasharray":r},z.constLines2={fill:"none",stroke:s.constellations.lineStyle.stroke[1],"stroke-width":s.constellations.lineStyle.width[1],"stroke-opacity":s.constellations.lineStyle.opacity[1],"stroke-dasharray":r},z.constLines3={fill:"none",stroke:s.constellations.lineStyle.stroke[2],"stroke-width":s.constellations.lineStyle.width[2],"stroke-opacity":s.constellations.lineStyle.opacity[2],"stroke-dasharray":r},t(null)}))})),D.defer((function(t){var e=u.rotate();u.rotate([0,0,0]),w.mapBorder.append("path").datum(j.outline).attr("class","mapBorder").attr("d",L),z.mapBorder={fill:"none",stroke:s.background.stroke,"stroke-width":s.background.width,"stroke-opacity":1,"stroke-dasharray":"none"},u.rotate(e),t(null)})),s.constellations.names&&D.defer((function(t){d3.json(o+U("constellations"),(function(e,a){e&&t(e);var n=P(a,s.transform);w.constNames.selectAll(".constnames").data(n.features.filter((function(t){return 1===N(t.geometry.coordinates)}))).enter().append("text").attr("class",(function(t){return"constNames"+t.properties.rank})).attr("transform",(function(t,e){return G(t.geometry.coordinates)})).text((function(t){return function(t){return t.properties[s.constellations.namesType]}(t)})),z.constNames1={fill:s.constellations.nameStyle.fill[0],"fill-opacity":s.constellations.nameStyle.opacity[0],font:s.constellations.nameStyle.font[0],"text-anchor":J(s.constellations.nameStyle.align)},z.constNames2={fill:s.constellations.nameStyle.fill[1],"fill-opacity":s.constellations.nameStyle.opacity[1],font:s.constellations.nameStyle.font[1],"text-anchor":J(s.constellations.nameStyle.align)},z.constNames3={fill:s.constellations.nameStyle.fill[2],"fill-opacity":s.constellations.nameStyle.opacity[2],font:s.constellations.nameStyle.font[2],"text-anchor":J(s.constellations.nameStyle.align)},t(null)}))})),s.stars.show&&D.defer((function(t){d3.json(o+s.stars.data,(function(e,a){e&&t(e);var n=P(a,s.transform);w.stars.selectAll(".stars").data(n.features.filter((function(t){return t.properties.mag<=s.stars.limit}))).enter().append("path").attr("class",(function(t){return"stars"+(e=t.properties.bv,!s.stars.colors||isNaN(e)?"":Math.round(10*e).toString());var e})).attr("d",L.pointRadius((function(t){return t.properties?function(t){if(null===t)return.1;var e=s.stars.size*m*Math.exp(s.stars.exponent*(t+2));return Math.max(e,.1)}(t.properties.mag):1}))),z.stars=W(s.stars.style);var r=C.domain();for(T=R(r[1],1);T<=R(r[0],1);T+=.1)z["stars"+Math.round(10*T).toString()]={fill:C(T)};s.stars.designation&&(w.starDesignations.selectAll(".stardesigs").data(n.features.filter((function(t){return t.properties.mag<=s.stars.designationLimit*m&&1===N(t.geometry.coordinates)}))).enter().append("text").attr("transform",(function(t){return G(t.geometry.coordinates)})).text((function(t){return function(t){return Y(f,t)?f[t][s.stars.designationType]:""}(t.id)})).attr({dy:".85em",dx:".35em",class:"starDesignations"}),z.starDesignations=V(s.stars.designationStyle)),s.stars.propername&&(w.starNames.selectAll(".starnames").data(n.features.filter((function(t){return t.properties.mag<=s.stars.propernameLimit*m&&1===N(t.geometry.coordinates)}))).enter().append("text").attr("transform",(function(t){return G(t.geometry.coordinates)})).text((function(t){return function(t){var e=s.stars.propernameType;return Y(f,t)?Y(f[t],e)?f[t][e]:f[t].name:""}(t.id)})).attr({dy:"-.5em",dx:"-.35em",class:"starNames"}),z.starNames=V(s.stars.propernameStyle)),t(null)}))})),s.dsos.show&&D.defer((function(t){d3.json(o+s.dsos.data,(function(e,n){e&&t(e);var r=P(n,s.transform);for(O in w.dsos.selectAll(".dsos").data(r.features.filter((function(t){return 1===N(t.geometry.coordinates)&&(999===t.properties.mag&&Math.sqrt(parseInt(t.properties.dim))>s.dsos.limit*m||999!==t.properties.mag&&t.properties.mag<=s.dsos.limit)}))).enter().append("path").attr("class",(function(t){return"dsos"+t.properties.type})).attr("transform",(function(t){return G(t.geometry.coordinates)})).attr("d",(function(t){return function(t){var e=(n=t.mag,r=t.dim,(n&&999!==n?Math.pow(2*s.dsos.size*m-n,s.dsos.exponent):Math.pow(parseInt(r)*s.dsos.size*m/7,.5))||9),a=function(t){return t&&Y(s.dsos.symbols,t)?s.dsos.symbols[t].shape:"circle"}(t.type);var n,r;return-1!==d3.svg.symbolTypes.indexOf(a)?d3.svg.symbol().type(a).size(e)():d3.svg.customSymbol().type(a).size(e)()}(t.properties)})),z.dsos=W(s.dsos.style),s.dsos.symbols)Y(s.dsos.symbols,O)&&(z[a="dsos"+O]={"fill-opacity":s.dsos.style.opacity,"stroke-opacity":s.dsos.style.opacity},Y(s.dsos.symbols[O],"stroke")?(z[a].fill="none",z[a].stroke=s.dsos.colors?s.dsos.symbols[O].stroke:s.dsos.style.stroke,z[a]["stroke-width"]=s.dsos.colors?s.dsos.symbols[O].width:s.dsos.style.width):(z[a].stroke="none",z[a].fill=s.dsos.colors?s.dsos.symbols[O].fill:s.dsos.style.fill));if(s.dsos.names)for(O in w.dsoNames.selectAll(".dsonames").data(r.features.filter((function(t){return 1===N(t.geometry.coordinates)&&(999==t.properties.mag&&Math.sqrt(parseInt(t.properties.dim))>s.dsos.nameLimit||999!=t.properties.mag&&t.properties.mag<=s.dsos.nameLimit)}))).enter().append("text").attr("class",(function(t){return"dsoNames "+t.properties.type})).attr("transform",(function(t){return G(t.geometry.coordinates)})).text((function(t){return function(t){var e=s.dsos.namesType,a=t.id;return"desig"!==e&&Y(h,a)&&Y(h[a],e)?h[a][e]:t.properties.desig}(t)})).attr({dy:"-.5em",dx:".35em"}),z.dsoNames={"fill-opacity":s.dsos.style.opacity,font:s.dsos.nameStyle.font,"text-anchor":J(s.dsos.nameStyle.align)},s.dsos.symbols)Y(s.dsos.symbols,O)&&(z[O]={fill:s.dsos.colors?s.dsos.symbols[O].fill:s.dsos.style.fill});t(null)}))})),(s.location||s.formFields.location)&&s.planets.show&&p.origin&&D.defer((function(t){var e=p.date(),a=p.origin(e).spherical(),n={type:"FeatureCollection",features:[]},r={type:"FeatureCollection",features:[]};if(p.container.selectAll(".planet").each((function(t){var o=t.id(),i=t(e).equatorial(a);i.ephemeris.pos=k(i.ephemeris.pos,S[s.transform]),1===N(i.ephemeris.pos)&&("lun"===o?r.features.push(K(i)):n.features.push(K(i)))})),"disk"===s.planets.symbolType?w.planets.selectAll(".planets").data(n.features).enter().append("path").attr("transform",(function(t){return G(t.geometry.coordinates)})).attr("d",(function(t){var e=Y(s.planets.symbols[t.id],"size")?(s.planets.symbols[t.id].size-1)*m:null;return function(t,e){var a=e?e*e:function(t){var e=t||2,a=4*m*Math.exp(-.05*(e+2));return Math.max(a,2)}(t.mag);return d3.svg.symbol().type("circle").size(a)()}(t.properties,e)})).attr("class",(function(t){return"planets "+t.id})):w.planets.selectAll(".planets").data(n.features).enter().append("text").attr("transform",(function(t){return G(t.geometry.coordinates)})).text((function(t){return t.properties.symbol})).attr("class",(function(t){return"planets "+t.id})).attr({dy:".35em"}),r.features.length>0)if("letter"===s.planets.symbolType)w.planets.selectAll(".moon").data(r.features).enter().append("text").attr("transform",(function(t){return G(t.geometry.coordinates)})).text((function(t){return t.properties.symbol})).attr("class",(function(t){return"planets "+t.id})).attr({dy:".35em"});else{var o=Y(s.planets.symbols.lun,"size")?(s.planets.symbols.lun.size-1)*m:11*m;w.planets.selectAll(".dmoon").data(r.features).enter().append("path").attr("class","darkluna").attr("transform",(function(t){return G(t.geometry.coordinates)})).attr("d",(function(t){return d3.svg.symbol().type("circle").size(o*o)()})),w.planets.selectAll(".moon").data(r.features).enter().append("path").attr("class",(function(t){return"planets "+t.id})).attr("transform",(function(t){return G(t.geometry.coordinates)})).attr("d",(function(t){return function(t,e){var a=e?e*e:121;return d3.svg.customSymbol().type("crescent").size(a).ratio(t.age)()}(t.properties,o)}))}for(O in z.planets=V(s.planets.symbolStyle),z.planets.font=function(t){var e=t.replace(/(^\D*)(\d+)(\D.+$)/i,"$2");return e=Math.round(m*e),t.replace(/(^\D*)(\d+)(\D.+$)/i,"$1"+e+"$3")}(s.planets.symbolStyle.font),z.darkluna={fill:"#557"},s.planets.symbols)Y(s.planets.symbols,O)&&(z[O]={fill:s.planets.symbols[O].fill});s.planets.names&&(w.planetNames.selectAll(".planetnames").data(n.features).enter().append("text").attr("transform",(function(t){return G(t.geometry.coordinates)})).text((function(t){return t.properties.name})).attr({dy:".85em",dx:"-.35em"}).attr("class",(function(t){return"planetNames "+t.id})),r.features.length>0&&w.planetNames.selectAll(".moonname").data(r.features).enter().append("text").attr("transform",(function(t){return G(t.geometry.coordinates)})).text((function(t){return t.properties.name})).attr({dy:".85em",dx:"-.35em"}).attr("class",(function(t){return"planetNames "+t.id}))),z.planetNames=V(s.planets.nameStyle),t(null)})),(s.location||s.formFields.location)&&s.daylight.show&&i.clip&&D.defer((function(t){var e=A("sol");if(e){var a=p.zenith(),n=e.ephemeris.pos,r=d3.geo.distance(a,n),s=u(n),o=d3.geo.circle().angle([179.95]).origin(n);w.daylight.append("path").datum(o).attr("class","daylight").attr("d",L),z.daylight=function(t,e){var a,n,r,s,o=1.36,i=1.885;if(t>i)return{fill:"transparent"};t<=o?(n="#daf1fa",r="#93d7f0",s="#57c0e8",a=-(o-t)/10):(a=(t-o)/(i-o),n=d3.interpolateLab("#daf1fa","#e8c866")(a),r=d3.interpolateLab("#93c7d0","#ff854a")(a),s=d3.interpolateLab("#57b0c8","#6caae2")(a));var l=w.daylight.append("radialGradient").attr("cx",e[0]).attr("cy",e[1]).attr("fr","0").attr("r","300").attr("id","skygradient").attr("gradientUnits","userSpaceOnUse");return l.append("stop").attr("offset","0").attr("stop-color",n),l.append("stop").attr("offset",.2+.4*a).attr("stop-color",r),l.append("stop").attr("offset","1").attr("stop-color",s),{fill:"url(#skygradient)","fill-opacity":$(a,1.4)}}(r,s),1===N(n)&&r<b&&w.daylight.append("circle").attr("cx",s[0]).attr("cy",s[1]).attr("r",5).style("fill","#fff")}t(null)})),(s.location||s.formFields.location)&&s.horizon.show&&!i.clip&&D.defer((function(t){var e=d3.geo.circle().angle([90]).origin(p.nadir());w.horizon.append("path").datum(e).attr("class","horizon").attr("d",L),z.horizon=W(s.horizon),t(null)})),p.data.length>0&&p.data.forEach((function(t){Y(t,"save")&&D.defer((function(e){t.save(),e(null)}))})),D.await((function(e){if(e)throw e;var a=d3.select("#d3-celestial-svg svg").attr("title","D3-Celestial").attr("version",1.1).attr("encoding","UTF-8").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("xmlns:sodipodi","http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd").attr("xmlns:inkscape","http://www.inkscape.org/namespaces/inkscape").attr("viewBox"," 0 0 "+r.width+" "+r.height);if(g.append("style").attr("type","text/css").text(function(){var t="";for(var e in z)Y(z,e)&&(t+=" ."+e+Q(z[e]));return"/*<![CDATA[*/\n"+t+"\n/*]]>*/"}()),t){var n=new Blob([a.node().outerHTML],{type:"image/svg+xml;charset=utf-8"}),s=d3.select("body").append("a").node();s.download=t||"d3-celestial.svg",s.rel="noopener",s.href=URL.createObjectURL(n),s.click(),d3.select(s).remove()}else null!==Tt&&Tt(a.node().outerHTML);d3.select("#d3-celestial-svg").remove()}))}var zt=d3.map({ellipse:function(t,e){var a=Math.sqrt(t),n=.666*a,r=a/3;return"M"+-n+","+-r+" m"+-n+",0 a"+n+","+r+" 0 1,0"+2*n+",0 a"+n+","+r+" 0 1,0"+-2*n+",0"},marker:function(t,e){var a=(t>48?t/4:12)/2,n=a-3;return"M "+-a+" 0 h "+n+" M 0 "+-a+" v "+n+" M "+a+" 0 h "+-n+" M 0 "+a+" v "+-n},"cross-circle":function(t,e){var a=Math.sqrt(t),n=a/2;return"M"+-n+","+-n+" m"+-n+",0 a"+n+","+n+" 0 1,0"+2*n+",0 a"+n+","+n+" 0 1,0"+-2*n+",0 M"+-n+" 0 h "+a+" M 0 "+-n+" v "+a},"stroke-circle":function(t,e){var a=Math.sqrt(t),n=a/2;return"M"+-n+","+-n+" m"+-n+",0 a"+n+","+n+" 0 1,0"+2*n+",0 a"+n+","+n+" 0 1,0"+-2*n+",0 M"+(-a-2)+","+(-a-2)+" l"+(a+4)+","+(a+4)},crescent:function(t,e){var a=Math.sqrt(t)/2,n=.5*(1-Math.cos(e)),r=1.6*Math.abs(n-.5)+.01,s=e>Math.PI?0:1;return"M -1,-1 m 1,"+(1-a)+" a"+a+","+a+" 0 1 "+s+" 0,"+2*a+" a"+a*r+","+a+" 0 1 "+(Math.abs(n)>.5?s:Math.abs(s-1))+" 0,"+-2*a+"z"}});d3.svg.customSymbol=function(){var t,e=64,a=d3.functor(1);function n(n,r){return zt.get(t.call(this,n,r))(e.call(this,n,r),a.call(this,n,r))}return n.type=function(e){return arguments.length?(t=d3.functor(e),n):t},n.size=function(t){return arguments.length?(e=d3.functor(t),n):e},n.ratio=function(t){return arguments.length?(a=d3.functor(t),n):a},n};var Tt=null;p.exportSVG=function(t){t&&(Tt=t,St())};var jt=function(t,e){var a=new Date,n=(d3.time.format("%Z"),[{"\u221212:00":-720},{"\u221211:00":-660},{"\u221210:00":-600},{"\u221209:30":-570},{"\u221209:00":-540},{"\u221208:00":-480},{"\u221207:00":-420},{"\u221206:00":-360},{"\u221205:00":-300},{"\u221204:30":-270},{"\u221204:00":-240},{"\u221203:30":-210},{"\u221203:00":-180},{"\u221202:30":-150},{"\u221202:00":-120},{"\u221201:00":-60},{"\xb100:00":0},{"+01:00":60},{"+02:00":120},{"+03:00":180},{"+03:30":210},{"+04:00":240},{"+04:30":270},{"+05:00":300},{"+05:30":330},{"+05:45":345},{"+06:00":360},{"+06:30":390},{"+07:00":420},{"+08:00":480},{"+08:30":510},{"+08:45":525},{"+09:00":540},{"+09:30":570},{"+10:00":600},{"+10:30":630},{"+11:00":660},{"+12:00":720},{"+12:45":765},{"+13:00":780},{"+14:00":840}]),r=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Su","M","Tu","W","Th","F","Sa"],i=(f(a),d3.time.format("%Y-%m-%d")),l=t.daterange||[],c=d3.select(s+" ~ #celestial-form").append("div").attr("id","celestial-date");u("left"),function(){var t=c.append("select").attr("title","Month").attr("id","mon").on("change",p),e=0,n=a.getMonth();t.selectAll("option").data(r).enter().append("option").attr("value",(function(t,a){return a===n&&(e=a),a})).text((function(t){return t})),t.property("selectedIndex",e)}(),c.append("select").attr("title","Year").attr("id","yr").on("change",p),d(),u("right");c.append("div").attr("id","cal");function p(){var t=mt("mon").value,e=mt("yr").value,n=new Date(e,t,1),r=d3.select(s+" ~ #celestial-form").select("#cal"),l=new Date;e=parseInt(e),t=parseInt(t),n.setDate(n.getDate()-n.getDay());for(var c=r.node();c.firstChild;)c.removeChild(c.firstChild);for(var p=0;p<7;p++)r.append("div").classed({date:!0,weekday:!0}).html(o[p]);for(p=0;p<42;p++){var d=n.getMonth(),u=n.getDay(),f=i(n);r.append("div").classed({date:!0,grey:d!==t,weekend:d===t&&(0===u||6===u),today:0===Q(n,l),selected:0===Q(n,a)}).attr("id",f).on("click",g).html(n.getDate().toString()),n.setDate(n.getDate()+1)}}function d(){var t=d3.select(s+" ~ #celestial-form").select("select#yr"),e=a.getFullYear(),n=0,r=f(a);t.selectAll("*").remove(),t.selectAll("option").data(r).enter().append("option").text((function(t,a){return t===e&&(n=a),t.toString()})),t.property("selectedIndex",n)}function u(t){c.append("div").attr("id",t).on("click",(function(){var e=mt("mon"),a=mt("yr");"left"===t?0===e.selectedIndex?(e.selectedIndex=11,a.selectedIndex--):e.selectedIndex--:11===e.selectedIndex?(e.selectedIndex=0,a.selectedIndex++):e.selectedIndex++,p()}))}function f(t){for(var e=function(t){if(!l||l.length<1)return[t-10,t+10];if(1===l.length&&J(l[0]))return l[0]>=100?[l[0]-10,l[0]+10]:[t-l[0],t+l[0]];if(2===l.length&&J(l[0])&&J(l[1]))return l[1]>=100?[l[0],l[1]]:[l[0]-l[1],l[0]+l[1]];return[t-10,t+10]}(t.getFullYear()),a=[],n=e[0];n<=e[1];n++)a.push(n);return a}function h(t,e){for(var a=mt(t),n=0;n<a.childNodes.length;n++)if(a.childNodes[n].value==e){a.selectedIndex=n;break}}function m(t){t&&a.setTime(t.valueOf()),h("yr",a.getFullYear()),h("mon",a.getMonth()),p(),mt("hr").value=a.getHours(),mt("min").value=a.getMinutes(),mt("sec").value=a.getSeconds()}function y(){d3.select(s+" ~ #celestial-form").select("#celestial-date").style("opacity",0),d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),d3.select(s+" ~ #celestial-form").select("#datepick").classed("active",!1),setTimeout((function(){mt("celestial-date").style.top=V(-9999)}),600)}function g(){var t=mt("hr").value,n=mt("min").value,r=mt("sec").value,s=mt("tz").value;this.id&&-1!==this.id.search(/^\d/)&&(a=i.parse(this.id)),d(),a.setHours(t,n,r),m(),e(a,s)}p(),c.append("input").attr("type","number").attr("id","hr").attr("title","Hours").attr("max","24").attr("min","-1").attr("step","1").attr("value",a.getHours()).on("change",(function(){!0===ct(this)&&g()})),c.append("input").attr("type","number").attr("id","min").attr("title","Minutes").attr("max","60").attr("min","-1").attr("step","1").attr("value",a.getMinutes()).on("change",(function(){!0===ct(this)&&g()})),c.append("input").attr("type","number").attr("id","sec").attr("title","Seconds").attr("max","60").attr("min","-1").attr("step","1").attr("value",a.getSeconds()).on("change",(function(){!0===ct(this)&&g()})),function(){var t=c.append("select").attr("title","Time zone offset from UTC").attr("id","tz").on("change",g),e=15,r=-a.getTimezoneOffset();t.selectAll("option").data(n).enter().append("option").attr("value",(function(t,a){var n=Object.keys(t)[0];return t[n]===r&&(e=a),t[n]})).text((function(t){return Object.keys(t)[0]})),t.property("selectedIndex",e)}(),this.show=function(t,e){var n=mt("celestial-date"),r=mt("datepick"),o=r.offsetLeft+r.offsetWidth-n.offsetWidth,i=r.offsetTop-n.offsetHeight-1;-9999===n.offsetTop?(a.setTime(t.valueOf()),h("tz",e),m(),d3.select(s+" ~ #celestial-form").select("#celestial-date").style({top:V(i),left:V(o),opacity:1}),d3.select(s+" ~ #celestial-form").select("#datepick").classed("active",!0)):y()},this.isVisible=function(){return!!document.getElementById("datepick")&&!0===d3.select(s+" ~ #celestial-form").select("#datepick").classed("active")},this.hide=function(){y()}};!function(){var t=Math.PI/180,e=180/Math.PI;function a(t,e,a){var n=t.translate(),r=Math.atan2(e[1]-n[1],e[0]-n[0])-Math.atan2(a[1]-n[1],a[0]-n[0]);return[Math.cos(r/2),0,0,Math.sin(r/2)]}function n(t,e){var a=t.invert(e);return a&&isFinite(a[0])&&isFinite(a[1])&&c(a)}function r(e){var a=.5*e[0]*t,n=.5*e[1]*t,r=.5*e[2]*t,s=Math.sin(a),o=Math.cos(a),i=Math.sin(n),l=Math.cos(n),c=Math.sin(r),p=Math.cos(r);return[o*l*p+s*i*c,s*l*p-o*i*c,o*i*p+s*l*c,o*l*c-s*i*p]}function s(t,e){var a=t[0],n=t[1],r=t[2],s=t[3],o=e[0],i=e[1],l=e[2],c=e[3];return[a*o-n*i-r*l-s*c,a*i+n*o+r*c-s*l,a*l-n*c+r*o+s*i,a*c+n*l-r*i+s*o]}function o(t,e){if(t&&e){var a=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}(t,e),n=Math.sqrt(p(a,a)),r=.5*Math.acos(Math.max(-1,Math.min(1,p(t,e)))),s=Math.sin(r)/n;return n&&[Math.cos(r),a[2]*s,-a[1]*s,a[0]*s]}}function i(t,e){var a=Math.max(-1,Math.min(1,p(t,e))),n=a<0?-1:1,r=Math.acos(n*a),s=Math.sin(r);return s?function(a){var o=n*Math.sin((1-a)*r)/s,i=Math.sin(a*r)/s;return[t[0]*o+e[0]*i,t[1]*o+e[1]*i,t[2]*o+e[2]*i,t[3]*o+e[3]*i]}:function(){return t}}function l(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*e,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*e,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*e]}function c(e){var a=e[0]*t,n=e[1]*t,r=Math.cos(n);return[r*Math.cos(a),r*Math.sin(a),Math.sin(n)]}function p(t,e){for(var a=0,n=t.length,r=0;a<n;++a)r+=t[a]*e[a];return r}d3.geo.zoom=function(){var t,e,p,d=0,u=function(t){var e=0,a=arguments.length,n=[];for(;++e<a;)n.push(arguments[e]);var r=d3.dispatch.apply(null,n);return r.of=function(e,a){return function(n){try{var s=n.sourceEvent=d3.event;n.target=t,d3.event=n,r[n.type].apply(e,a)}finally{d3.event=s}}},r}(f,"zoomstart","zoom","zoomend"),f=d3.behavior.zoom().on("zoomstart",(function(){var e=d3.mouse(this),i=r(t.rotate()),c=n(t,e);c&&(p=c),h.call(f,"zoom",(function(){t.scale(m.k=d3.event.scale);var r=d3.mouse(this),c=o(p,n(t,r));t.rotate(m.r=l(i=c?s(i,c):s(a(t,e,r),i))),e=r,g(u.of(this,arguments))})),y(u.of(this,arguments))})).on("zoomend",(function(){h.call(f,"zoom",null),v(u.of(this,arguments))})),h=f.on,m={r:[0,0,0],k:1};function y(t){d++||t({type:"zoomstart"})}function g(t){t({type:"zoom"})}function v(t){--d||t({type:"zoomend"})}return f.rotateTo=function(t){var e=o(c(t),c([-m.r[0],-m.r[1]]));return l(s(r(m.r),e))},f.projection=function(e){return arguments.length?(m={r:(t=e).rotate(),k:t.scale()},f.scale(m.k)):t},f.duration=function(t){return arguments.length?(e=t,f):e},f.event=function(a){a.each((function(){var a=d3.select(this),n=u.of(this,arguments),s=m,o=d3.transition(a);if(o!==a){o.each("start.zoom",(function(){this.__chart__&&((m=this.__chart__).hasOwnProperty("r")||(m.r=t.rotate())),t.rotate(m.r).scale(m.k),y(n)})).tween("zoom:zoom",(function(){var a=f.size()[0],c=i(r(m.r),r(s.r)),p=d3.geo.distance(m.r,s.r),d=d3.interpolateZoom([0,0,a/m.k],[p,0,a/s.k]);return e&&o.duration(e(.001*d.duration)),function(e){var r=d(e);this.__chart__=m={r:l(c(r[0]/p)),k:a/r[2]},t.rotate(m.r).scale(m.k),f.scale(m.k),g(n)}})).each("end.zoom",(function(){v(n)}));try{o.each("interrupt.zoom",(function(){v(n)}))}catch(c){console.log(c)}}else this.__chart__=m,y(n),g(n),v(n)}))},d3.rebind(f,u,"on")}}(),function(t){"use strict";var e=[].slice,a={};function n(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function r(t){if(!t._start)try{s(t)}catch(e){if(t._tasks[t._ended+t._active-1])i(t,e);else if(!t._data)throw e}}function s(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,n=t._tasks[e],r=n.length-1,s=n[r];n[r]=o(t,e),--t._waiting,++t._active,n=s.apply(null,n),t._tasks[e]&&(t._tasks[e]=n||a)}}function o(t,e){return function(a,n){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=a?i(t,a):(t._data[e]=n,t._waiting?r(t):l(t))))}}function i(t,e){var a,n=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--n>=0;)if((a=t._tasks[n])&&(t._tasks[n]=null,a.abort))try{a.abort()}catch(e){}t._active=NaN,l(t)}function l(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function c(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error("invalid concurrency");return new n(t)}n.prototype=c.prototype={constructor:n,defer:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var a=e.call(arguments,1);return a.push(t),++this._waiting,this._tasks.push(a),r(this),this},abort:function(){return null==this._error&&i(this,new Error("abort")),this},await:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,a){t.apply(null,[e].concat(a))},l(this),this},awaitAll:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,l(this),this}},t.queue=c,d3.queue=c,Object.defineProperty(t,"__esModule",{value:!0})}(e),this.Celestial=p}()}}]);